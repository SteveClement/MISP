



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="MISP Project - Install Guides">
      
      
        <link rel="canonical" href="https://www.misp-project.org/xINSTALL.OpenBSD/">
      
      
        <meta name="author" content="MISP Project">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>OpenBSD 6.4 - MISP Install Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#installation-instructions" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.misp-project.org/" title="MISP Install Documentation" class="md-header-nav__button md-logo">
          
            <img src="../img/misp.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                MISP Install Documentation
              </span>
              <span class="md-header-nav__topic">
                OpenBSD 6.4
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/MISP/MISP" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      MISP/MISP
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.misp-project.org/" title="MISP Install Documentation" class="md-nav__button md-logo">
      
        <img src="../img/misp.png" width="48" height="48">
      
    </a>
    MISP Install Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/MISP/MISP" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      MISP/MISP
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Install Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Install Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.ubuntu1804/" title="Ubuntu 18.04" class="md-nav__link">
      Ubuntu 18.04
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.ubuntu1804.with.webmin/" title="Ubuntu 18.04 \w webmin" class="md-nav__link">
      Ubuntu 18.04 \w webmin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.debian9/" title="Debian stable" class="md-nav__link">
      Debian stable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.kali/" title="Kali Linux" class="md-nav__link">
      Kali Linux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.rhel7/" title="Redhat Enterprise Linux 7" class="md-nav__link">
      Redhat Enterprise Linux 7
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      xInstall Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        xInstall Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL/" title="Warning" class="md-nav__link">
      Warning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.centos6/" title="Centos 6" class="md-nav__link">
      Centos 6
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.centos7/" title="Centos 7" class="md-nav__link">
      Centos 7
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.debian_testing/" title="Debian testing" class="md-nav__link">
      Debian testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.debian9-postgresql/" title="Debian 9 \w postgresql" class="md-nav__link">
      Debian 9 \w postgresql
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        OpenBSD 6.4
      </label>
    
    <a href="./" title="OpenBSD 6.4" class="md-nav__link md-nav__link--active">
      OpenBSD 6.4
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#for-openbsd-64-amd64" title="for OpenBSD 6.4-amd64" class="md-nav__link">
    for OpenBSD 6.4-amd64
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0-wip-you-are-warned-this-does-not-work-yet" title="0/ WIP! You are warned, this does not work yet!" class="md-nav__link">
    0/ WIP! You are warned, this does not work yet!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-minimal-openbsd-install" title="1/ Minimal OpenBSD install" class="md-nav__link">
    1/ Minimal OpenBSD install
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-standard-openbsd-amd64-with-ports" title="Install standard OpenBSD-amd64 with ports" class="md-nav__link">
    Install standard OpenBSD-amd64 with ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-hardening" title="System Hardening" class="md-nav__link">
    System Hardening
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misp-configuration-variables" title="MISP configuration variables" class="md-nav__link">
    MISP configuration variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#doas-pkg-as-root" title="doas &amp; pkg (as root)" class="md-nav__link">
    doas &amp; pkg (as root)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#in-case-you-forgot-to-fetch-ports-optional" title="In case you forgot to fetch ports (optional)" class="md-nav__link">
    In case you forgot to fetch ports (optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-system" title="Update system" class="md-nav__link">
    Update system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-bash-ntp" title="Install bash &amp; ntp" class="md-nav__link">
    Install bash &amp; ntp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mariadb-server" title="mariadb server" class="md-nav__link">
    mariadb server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-misc-dependencies" title="Install misc dependencies" class="md-nav__link">
    Install misc dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nvim-optional" title="nvim (optional)" class="md-nav__link">
    nvim (optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rclocal-add-ntpdate-on-boot" title="rc.local - Add ntpdate on boot" class="md-nav__link">
    rc.local - Add ntpdate on boot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch-ntpd-on-boot" title="Launch ntpd on boot" class="md-nav__link">
    Launch ntpd on boot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misp-user" title="misp user" class="md-nav__link">
    misp user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etchttpdconf" title="/etc/httpd.conf" class="md-nav__link">
    /etc/httpd.conf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-a-valid-ssl-certificate-is-not-already-created-for-the-server-create-a-self-signed-certificate" title="If a valid SSL certificate is not already created for the server, create a self-signed certificate:" class="md-nav__link">
    If a valid SSL certificate is not already created for the server, create a self-signed certificate:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-httpd" title="start httpd" class="md-nav__link">
    start httpd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-httpd" title="Enable httpd" class="md-nav__link">
    Enable httpd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-python-virtualenv" title="Install Python virtualenv" class="md-nav__link">
    Install Python virtualenv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-ssdeep" title="Install ssdeep" class="md-nav__link">
    Install ssdeep
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apache2-only" title="Apache2 only" class="md-nav__link">
    Apache2 only
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etcphp-70ini" title="/etc/php-7.0.ini" class="md-nav__link">
    /etc/php-7.0.ini
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#php-symlinks" title="php symlinks" class="md-nav__link">
    php symlinks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-php-fpm" title="Enable php fpm" class="md-nav__link">
    Enable php fpm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-fpm" title="Configure fpm" class="md-nav__link">
    Configure fpm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-redis" title="Enable redis" class="md-nav__link">
    Enable redis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-mysqld" title="Enable mysqld" class="md-nav__link">
    Enable mysqld
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-misp-code" title="2/ MISP code" class="md-nav__link">
    2/ MISP code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-cakephp" title="3/ CakePHP" class="md-nav__link">
    3/ CakePHP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-set-the-permissions" title="4/ Set the permissions" class="md-nav__link">
    4/ Set the permissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-create-a-database-and-user" title="5/ Create a database and user" class="md-nav__link">
    5/ Create a database and user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-apache-configuration-optional" title="6/ Apache configuration (optional)" class="md-nav__link">
    6/ Apache configuration (optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-misp-configuration" title="8/ MISP configuration" class="md-nav__link">
    8/ MISP configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misp-modules" title="MISP Modules" class="md-nav__link">
    MISP Modules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misp-config-automation" title="MISP Config Automation" class="md-nav__link">
    MISP Config Automation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recommended-actions" title="Recommended actions" class="md-nav__link">
    Recommended actions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-features" title="Optional features" class="md-nav__link">
    Optional features
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeromq-depends-on-the-python-client-for-redis" title="ZeroMQ depends on the Python client for Redis" class="md-nav__link">
    ZeroMQ depends on the Python client for Redis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misp-dashboard" title="misp-dashboard" class="md-nav__link">
    misp-dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.rhel7/" title="Redhat Enterprise Linux 7.6 (BETA)" class="md-nav__link">
      Redhat Enterprise Linux 7.6 (BETA)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Config Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Config Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CONFIG.elasticsearch-logging/" title="Elastic Search Logging" class="md-nav__link">
      Elastic Search Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CONFIG.s3-attachments/" title="Amazon S3 attachments" class="md-nav__link">
      Amazon S3 attachments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CONFIG.SMIME/" title="S/MIME" class="md-nav__link">
      S/MIME
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../UPDATE/" title="Update MISP" class="md-nav__link">
      Update MISP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../UPGRADE/" title="Upgrading MISP" class="md-nav__link">
      Upgrading MISP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Old guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Old guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../old-2_3to2_4-UPGRADE/" title="2.3 to 2.4 upgrade" class="md-nav__link">
      2.3 to 2.4 upgrade
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Changelog/" title="MISP Release Notes" class="md-nav__link">
      MISP Release Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#for-openbsd-64-amd64" title="for OpenBSD 6.4-amd64" class="md-nav__link">
    for OpenBSD 6.4-amd64
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0-wip-you-are-warned-this-does-not-work-yet" title="0/ WIP! You are warned, this does not work yet!" class="md-nav__link">
    0/ WIP! You are warned, this does not work yet!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-minimal-openbsd-install" title="1/ Minimal OpenBSD install" class="md-nav__link">
    1/ Minimal OpenBSD install
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-standard-openbsd-amd64-with-ports" title="Install standard OpenBSD-amd64 with ports" class="md-nav__link">
    Install standard OpenBSD-amd64 with ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-hardening" title="System Hardening" class="md-nav__link">
    System Hardening
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misp-configuration-variables" title="MISP configuration variables" class="md-nav__link">
    MISP configuration variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#doas-pkg-as-root" title="doas &amp; pkg (as root)" class="md-nav__link">
    doas &amp; pkg (as root)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#in-case-you-forgot-to-fetch-ports-optional" title="In case you forgot to fetch ports (optional)" class="md-nav__link">
    In case you forgot to fetch ports (optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-system" title="Update system" class="md-nav__link">
    Update system
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-bash-ntp" title="Install bash &amp; ntp" class="md-nav__link">
    Install bash &amp; ntp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mariadb-server" title="mariadb server" class="md-nav__link">
    mariadb server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-misc-dependencies" title="Install misc dependencies" class="md-nav__link">
    Install misc dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nvim-optional" title="nvim (optional)" class="md-nav__link">
    nvim (optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rclocal-add-ntpdate-on-boot" title="rc.local - Add ntpdate on boot" class="md-nav__link">
    rc.local - Add ntpdate on boot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch-ntpd-on-boot" title="Launch ntpd on boot" class="md-nav__link">
    Launch ntpd on boot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misp-user" title="misp user" class="md-nav__link">
    misp user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etchttpdconf" title="/etc/httpd.conf" class="md-nav__link">
    /etc/httpd.conf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-a-valid-ssl-certificate-is-not-already-created-for-the-server-create-a-self-signed-certificate" title="If a valid SSL certificate is not already created for the server, create a self-signed certificate:" class="md-nav__link">
    If a valid SSL certificate is not already created for the server, create a self-signed certificate:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-httpd" title="start httpd" class="md-nav__link">
    start httpd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-httpd" title="Enable httpd" class="md-nav__link">
    Enable httpd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-python-virtualenv" title="Install Python virtualenv" class="md-nav__link">
    Install Python virtualenv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-ssdeep" title="Install ssdeep" class="md-nav__link">
    Install ssdeep
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apache2-only" title="Apache2 only" class="md-nav__link">
    Apache2 only
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etcphp-70ini" title="/etc/php-7.0.ini" class="md-nav__link">
    /etc/php-7.0.ini
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#php-symlinks" title="php symlinks" class="md-nav__link">
    php symlinks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-php-fpm" title="Enable php fpm" class="md-nav__link">
    Enable php fpm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-fpm" title="Configure fpm" class="md-nav__link">
    Configure fpm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-redis" title="Enable redis" class="md-nav__link">
    Enable redis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-mysqld" title="Enable mysqld" class="md-nav__link">
    Enable mysqld
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-misp-code" title="2/ MISP code" class="md-nav__link">
    2/ MISP code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-cakephp" title="3/ CakePHP" class="md-nav__link">
    3/ CakePHP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-set-the-permissions" title="4/ Set the permissions" class="md-nav__link">
    4/ Set the permissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-create-a-database-and-user" title="5/ Create a database and user" class="md-nav__link">
    5/ Create a database and user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-apache-configuration-optional" title="6/ Apache configuration (optional)" class="md-nav__link">
    6/ Apache configuration (optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-misp-configuration" title="8/ MISP configuration" class="md-nav__link">
    8/ MISP configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misp-modules" title="MISP Modules" class="md-nav__link">
    MISP Modules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misp-config-automation" title="MISP Config Automation" class="md-nav__link">
    MISP Config Automation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recommended-actions" title="Recommended actions" class="md-nav__link">
    Recommended actions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-features" title="Optional features" class="md-nav__link">
    Optional features
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeromq-depends-on-the-python-client-for-redis" title="ZeroMQ depends on the Python client for Redis" class="md-nav__link">
    ZeroMQ depends on the Python client for Redis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misp-dashboard" title="misp-dashboard" class="md-nav__link">
    misp-dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="installation-instructions">INSTALLATION INSTRUCTIONS<a class="headerlink" href="#installation-instructions" title="Permanent link">&para;</a></h1>
<h2 id="for-openbsd-64-amd64">for OpenBSD 6.4-amd64<a class="headerlink" href="#for-openbsd-64-amd64" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is not fully working yet. Mostly it is a template for our ongoing documentation efforts <img alt="🕷" class="emojione" src="https://cdn.jsdelivr.net/emojione/assets/svg/1f577.svg" title=":spider:" />
    LIEF, will probably not be available for a long long time on OpenBSD, until someone is brave enough to make it work.
    GnuPG also needs some more TLC.</p>
</div>
<h3 id="0-wip-you-are-warned-this-does-not-work-yet">0/ WIP! You are warned, this does not work yet!<a class="headerlink" href="#0-wip-you-are-warned-this-does-not-work-yet" title="Permanent link">&para;</a></h3>
<hr />
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Current issues: php-redis only available in binary for php-56, workaround: use OpenBSD 6.4.
This guide attempts to offer native httpd or apache2/nginx.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As of 20181018 the native httpd server is NOT useable with MISP on OpenBSD 6.3.
Thus ONLY Apache 2.x available.
NO <em>rewrite</em> available, just yet. It will be in <a href="https://marc.info/?l=openbsd-tech&amp;m=152761257806283&amp;w=2">the next release</a></p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>As of OpenBSD 6.4 the native httpd has rewrite rules and php 5.6 is gone too.</p>
</div>
<h3 id="1-minimal-openbsd-install">1/ Minimal OpenBSD install<a class="headerlink" href="#1-minimal-openbsd-install" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="install-standard-openbsd-amd64-with-ports">Install standard OpenBSD-amd64 with ports<a class="headerlink" href="#install-standard-openbsd-amd64-with-ports" title="Permanent link">&para;</a></h4>
<h4 id="system-hardening">System Hardening<a class="headerlink" href="#system-hardening" title="Permanent link">&para;</a></h4>
<ul>
<li>TBD</li>
</ul>
<h4 id="misp-configuration-variables">MISP configuration variables<a class="headerlink" href="#misp-configuration-variables" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nb">export</span> <span class="nv">PATH_TO_MISP</span><span class="o">=</span><span class="s1">&#39;/var/www/htdocs/MISP&#39;</span>
<span class="nb">export</span> <span class="nv">MISP_BASEURL</span><span class="o">=</span><span class="s1">&#39;https://misp.local&#39;</span>
<span class="nb">export</span> <span class="nv">MISP_LIVE</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>
<span class="nb">export</span> <span class="nv">CAKE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PATH_TO_MISP</span><span class="s2">/app/Console/cake&quot;</span>
<span class="nb">export</span> <span class="nv">AUTOMAKE_VERSION</span><span class="o">=</span><span class="m">1</span>.16
<span class="nb">export</span> <span class="nv">AUTOCONF_VERSION</span><span class="o">=</span><span class="m">2</span>.69
</pre></div>

<h4 id="doas-pkg-as-root">doas &amp; pkg (as root)<a class="headerlink" href="#doas-pkg-as-root" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nb">echo</span> https://cdn.openbsd.org/pub/OpenBSD/ &gt; /etc/installurl
<span class="nb">echo</span> <span class="s2">&quot;permit keepenv setenv { PKG_PATH ENV PS1 SSH_AUTH_SOCK } :wheel&quot;</span> &gt; /etc/doas.conf
</pre></div>

<h5 id="in-case-you-forgot-to-fetch-ports-optional">In case you forgot to fetch ports (optional)<a class="headerlink" href="#in-case-you-forgot-to-fetch-ports-optional" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> /tmp
ftp https://ftp.openbsd.org/pub/OpenBSD/<span class="k">$(</span>uname -r<span class="k">)</span>/<span class="o">{</span>ports.tar.gz,SHA256.sig<span class="o">}</span>
signify -Cp /etc/signify/openbsd-<span class="k">$(</span>uname -r <span class="p">|</span> cut -c <span class="m">1</span>,3<span class="k">)</span>-base.pub -x SHA256.sig ports.tar.gz
doas tar -x -z -f /tmp/ports.tar.gz -C /usr
</pre></div>

<h4 id="update-system">Update system<a class="headerlink" href="#update-system" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas syspatch
</pre></div>

<h4 id="install-bash-ntp">Install bash &amp; ntp<a class="headerlink" href="#install-bash-ntp" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas pkg_add -v bash ntp
</pre></div>

<h4 id="mariadb-server">mariadb server<a class="headerlink" href="#mariadb-server" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas pkg_add -v mariadb-server 
</pre></div>

<h4 id="install-misc-dependencies">Install misc dependencies<a class="headerlink" href="#install-misc-dependencies" title="Permanent link">&para;</a></h4>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>You need to install python 3.x when asked, option 2.
autoconf wants to be version 2.69, option 16
automake wants to be version 1.16, option 7</p>
</div>
<div class="codehilite"><pre><span></span>doas pkg_add -v curl git python redis libmagic autoconf automake libtool
</pre></div>

<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>GnuPG 2.x is best, option 3.</p>
</div>
<div class="codehilite"><pre><span></span>doas pkg_add -v gnupg
doas ln -s /usr/local/bin/gpg2 /usr/local/bin/gpg
</pre></div>

<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>When asked, the standard postfix will be enough for a basic setup, option 9.</p>
</div>
<div class="codehilite"><pre><span></span>doas pkg_add -v postfix
doas /usr/local/sbin/postfix-enable 
</pre></div>

<h4 id="nvim-optional">nvim (optional)<a class="headerlink" href="#nvim-optional" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas pkg_add -v neovim
doas mv /usr/bin/vi /usr/bin/vi-<span class="sb">`</span>date +%d%m%y<span class="sb">`</span>
doas ln -s /usr/local/bin/nvim /usr/bin/vi
</pre></div>

<h4 id="rclocal-add-ntpdate-on-boot">rc.local - Add ntpdate on boot<a class="headerlink" href="#rclocal-add-ntpdate-on-boot" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;echo -n &#39; ntpdate&#39;&quot;</span> <span class="p">|</span>doas tee -a /etc/rc.local
<span class="nb">echo</span> <span class="s2">&quot;/usr/local/sbin/ntpdate -b pool.ntp.org &gt;/dev/null&quot;</span> <span class="p">|</span>doas tee -a /etc/rc.local
</pre></div>

<h4 id="launch-ntpd-on-boot">Launch ntpd on boot<a class="headerlink" href="#launch-ntpd-on-boot" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas rcctl <span class="nb">enable</span> xntpd
doas rcctl <span class="nb">set</span> xntpd flags <span class="s2">&quot;-p /var/run/ntpd.pid&quot;</span>
doas /usr/local/sbin/ntpd -p /var/run/ntpd.pid
</pre></div>

<h4 id="misp-user">misp user<a class="headerlink" href="#misp-user" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas useradd -m -s /usr/local/bin/bash -G wheel,www misp
</pre></div>

<h4 id="etchttpdconf">/etc/httpd.conf<a class="headerlink" href="#etchttpdconf" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas cp /etc/examples/httpd.conf /etc <span class="c1"># adjust by hand, or copy/paste the config example below</span>
</pre></div>

<div class="codehilite"><pre><span></span># $OpenBSD: httpd.conf,v 1.18 2018/03/23 11:36:41 florian Exp $

#
# Macros
#
ext4_addr=&quot;*&quot;
ext6_addr=&quot;::&quot;

server &quot;default&quot; {
        #listen on $ext4_addr port 80 block return 301 &quot;https://$SERVER_NAME$REQUEST_URI&quot;
        listen on $ext4_addr port 80
        listen on $ext4_addr tls port 443
        #listen on $ext6_addr port 80 block return 301 &quot;https://$SERVER_NAME$REQUEST_URI&quot;
        listen on $ext6_addr port 80
        listen on $ext6_addr tls port 443

        root &quot;/htdocs/MISP/app/webroot&quot;

        tls {
                key &quot;/etc/ssl/private/server.key&quot;
                certificate &quot;/etc/ssl/server.crt&quot;
        }
        directory {
                index &quot;index.php&quot;
        }
        location &quot;*.php&quot; {
                fastcgi socket &quot;/run/php-fpm.sock&quot;
        }
        location match &quot;/(.*)&quot; {
                request rewrite &quot;/$HTTP_HOST/%1&quot;
        }
# Temporary Apache 2.x rewrite rules for future foo!
        #RewriteRule    ^$    webroot/    [L]
        #RewriteRule    (.*) webroot/$1    [L]
# Temporary Apache 2.x rewrite rules for future foo!

        #location &quot;/.well-known/acme-challenge/*&quot; {
        #       root &quot;/acme&quot;
        #       root strip 2
        #}
        #location * {
        #       block return 302 &quot;https://$HTTP_HOST$REQUEST_URI&quot;
        #}
}

# Include MIME types instead of the built-in ones
types {
        include &quot;/usr/share/misc/mime.types&quot;
}

#server &quot;example.com&quot; {
#       listen on * tls port 443
#       listen on :: tls port 443
#       tls {
#               certificate &quot;/etc/ssl/example.com.fullchain.pem&quot;
#               key &quot;/etc/ssl/private/example.com.key&quot;
#       }
#       location &quot;/pub/*&quot; {
#               directory auto index
#       }
#       location &quot;/.well-known/acme-challenge/*&quot; {
#               root &quot;/acme&quot;
#               root strip 2
#       }
#}
</pre></div>

<h4 id="if-a-valid-ssl-certificate-is-not-already-created-for-the-server-create-a-self-signed-certificate">If a valid SSL certificate is not already created for the server, create a self-signed certificate:<a class="headerlink" href="#if-a-valid-ssl-certificate-is-not-already-created-for-the-server-create-a-self-signed-certificate" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span># OpenSSL configuration
OPENSSL_C=&#39;LU&#39;
OPENSSL_ST=&#39;State&#39;
OPENSSL_L=&#39;Location&#39;
OPENSSL_O=&#39;Organization&#39;
OPENSSL_OU=&#39;Organizational Unit&#39;
OPENSSL_CN=&#39;Common Name&#39;
OPENSSL_EMAILADDRESS=&#39;info@localhost&#39;
</pre></div>

<div class="codehilite"><pre><span></span>doas openssl req -newkey rsa:4096 -days <span class="m">3650</span> -nodes -x509 -subj <span class="s2">&quot;/C=</span><span class="nv">$OPENSSL_C</span><span class="s2">/ST=</span><span class="nv">$OPENSSL_ST</span><span class="s2">/L=</span><span class="nv">$OPENSSL_L</span><span class="s2">/O=&lt;</span><span class="nv">$OPENSSL_O</span><span class="s2">/OU=</span><span class="nv">$OPENSSL_OU</span><span class="s2">/CN=</span><span class="nv">$OPENSSL_CN</span><span class="s2">/emailAddress=</span><span class="nv">$OPENSSL_EMAILADDRESS</span><span class="s2">&quot;</span> -keyout /etc/ssl/private/server.key -out /etc/ssl/server.crt
</pre></div>

<h4 id="start-httpd">start httpd<a class="headerlink" href="#start-httpd" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas /etc/rc.d/httpd -f start
</pre></div>

<h4 id="enable-httpd">Enable httpd<a class="headerlink" href="#enable-httpd" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas rcctl <span class="nb">enable</span> httpd
</pre></div>

<h4 id="install-python-virtualenv">Install Python virtualenv<a class="headerlink" href="#install-python-virtualenv" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas ln -sf /usr/local/bin/pip3.6 /usr/local/bin/pip
doas ln -s /usr/local/bin/python3.6 /usr/local/bin/python
doas pkg_add -v py-virtualenv
doas mkdif /usr/local/virtualenvs
doas virtualenv -ppython3 /usr/local/virtualenvs/MISP
</pre></div>

<h4 id="install-ssdeep">Install ssdeep<a class="headerlink" href="#install-ssdeep" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas mkdir /usr/local/src
doas chown misp:misp /usr/local/src
cd /usr/local/src
git clone https://github.com/ssdeep-project/ssdeep.git
cd ssdeep
./bootstrap
./configure --prefix=/usr
make
doas make install
</pre></div>

<h4 id="apache2-only">Apache2 only<a class="headerlink" href="#apache2-only" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas pkg_add -v apache-httpd
doas pkg_add -v fcgi-cgi fcgi
</pre></div>

<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>php-5.6 is marked as end-of-life starting December 2018, use php 7.0 instead.
Option 2.
If on OpenBSD 6.3, upgrade to 6.4 to make your life much easier.</p>
</div>
<div class="codehilite"><pre><span></span>doas pkg_add -v php-mysqli php-pcntl php-pdo_mysql php-apache pecl70-redis
</pre></div>

<h4 id="etcphp-70ini">/etc/php-7.0.ini<a class="headerlink" href="#etcphp-70ini" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>allow_url_fopen = On
</pre></div>

<div class="codehilite"><pre><span></span><span class="nb">cd</span> /etc/php-7.0
doas cp ../php-7.0.sample/* .
</pre></div>

<h4 id="php-symlinks">php symlinks<a class="headerlink" href="#php-symlinks" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas ln -s /usr/local/bin/php-7.0 /usr/local/bin/php
doas ln -s /usr/local/bin/phpize-7.0 /usr/local/bin/phpize
doas ln -s /usr/local/bin/php-config-7.0 /usr/local/bin/php-config
</pre></div>

<h4 id="enable-php-fpm">Enable php fpm<a class="headerlink" href="#enable-php-fpm" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas rcctl <span class="nb">enable</span> php70_fpm
</pre></div>

<h4 id="configure-fpm">Configure fpm<a class="headerlink" href="#configure-fpm" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas vi /etc/php-fpm.conf

# pid = /var/www/run/php-fpm.pid
# error_log = /var/www/logs/php-fpm.log
# listen = /var/www/run/php-fpm.sock

doas /etc/rc.d/php70_fpm start 
</pre></div>

<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>For native httpd: listen = /var/www/run/php-fpm.sock
For apache2: listen = 127.0.0.1:9000</p>
</div>
<h4 id="enable-redis">Enable redis<a class="headerlink" href="#enable-redis" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas rcctl <span class="nb">enable</span> redis
doas /etc/rc.d/redis start
</pre></div>

<h4 id="enable-mysqld">Enable mysqld<a class="headerlink" href="#enable-mysqld" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas /usr/local/bin/mysql_install_db
doas rcctl <span class="nb">set</span> mysqld status on
doas rcctl <span class="nb">set</span> mysqld flags --bind-address<span class="o">=</span><span class="m">127</span>.0.0.1
doas /etc/rc.d/mysqld start
doas mysql_secure_installation
</pre></div>

<h3 id="2-misp-code">2/ MISP code<a class="headerlink" href="#2-misp-code" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># Download MISP using git in the /usr/local/www/ directory.</span>
doas mkdir /var/www/htdocs/MISP
doas chown www:www /var/www/htdocs/MISP
<span class="nb">cd</span> /var/www/htdocs/MISP
doas -u www git clone https://github.com/MISP/MISP.git /var/www/htdocs/MISP
doas -u www git submodule update --init --recursive
<span class="c1"># Make git ignore filesystem permission differences for submodules</span>
doas -u www git submodule foreach --recursive git config core.filemode <span class="nb">false</span>

<span class="c1"># Make git ignore filesystem permission differences</span>
doas -u www git config core.filemode <span class="nb">false</span>

doas pkg_add py-pip py3-pip libxml libxslt py3-jsonschema
doas /usr/local/virtualenvs/MISP/bin/pip install -U pip

<span class="nb">cd</span> /var/www/htdocs/MISP/app/files/scripts
doas -u www git clone https://github.com/CybOXProject/python-cybox.git
doas -u www git clone https://github.com/STIXProject/python-stix.git
<span class="nb">cd</span> /var/www/htdocs/MISP/app/files/scripts/python-cybox
doas /usr/local/virtualenvs/MISP/bin/python setup.py install
<span class="nb">cd</span> /var/www/htdocs/MISP/app/files/scripts/python-stix
doas /usr/local/virtualenvs/MISP/bin/python setup.py install

<span class="c1"># install mixbox to accomodate the new STIX dependencies:</span>
<span class="nb">cd</span> /var/www/htdocs/MISP/app/files/scripts/
doas -u www git clone https://github.com/CybOXProject/mixbox.git
<span class="nb">cd</span> /var/www/htdocs/MISP/app/files/scripts/mixbox
doas /usr/local/virtualenvs/MISP/bin/python setup.py install

<span class="c1"># install PyMISP</span>
<span class="nb">cd</span> /var/www/htdocs/MISP/PyMISP
doas /usr/local/virtualenvs/MISP/bin/python setup.py install

<span class="c1"># install support for STIX 2.0</span>
doas /usr/local/virtualenvs/MISP/bin/pip install stix2

<span class="c1"># install python-magic, pydeep and maec</span>
doas /usr/local/virtualenvs/MISP/bin/pip install python-magic
doas /usr/local/virtualenvs/MISP/bin/pip install git+https://github.com/kbandla/pydeep.git
doas /usr/local/virtualenvs/MISP/bin/pip install maec
</pre></div>

<h3 id="3-cakephp">3/ CakePHP<a class="headerlink" href="#3-cakephp" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># CakePHP is included as a submodule of MISP and has been fetched earlier.</span>
<span class="c1"># Install CakeResque along with its dependencies if you intend to use the built in background jobs:</span>
<span class="nb">cd</span> /var/www/htdocs/MISP/app
mkdir /var/www/.composer <span class="p">;</span> chown www:www /var/www/.composer
doas -u www php composer.phar require kamisama/cake-resque:4.1.2
doas -u www php composer.phar config vendor-dir Vendor
doas -u www php composer.phar install

<span class="c1"># To use the scheduler worker for scheduled tasks, do the following:</span>
doas -u www cp -f /var/www/htdocs/MISP/INSTALL/setup/config.php /var/www/htdocs/MISP/app/Plugin/CakeResque/Config/config.php
</pre></div>

<h3 id="4-set-the-permissions">4/ Set the permissions<a class="headerlink" href="#4-set-the-permissions" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># Check if the permissions are set correctly using the following commands:</span>
doas chown -R www:www /var/www/htdocs/MISP
doas chmod -R <span class="m">750</span> /var/www/htdocs/MISP
doas chmod -R g+ws /var/www/htdocs/MISP/app/tmp
doas chmod -R g+ws /var/www/htdocs/MISP/app/files
doas chmod -R g+ws /var/www/htdocs/MISP/app/files/scripts/tmp
</pre></div>

<h3 id="5-create-a-database-and-user">5/ Create a database and user<a class="headerlink" href="#5-create-a-database-and-user" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># Enter the mysql shell</span>
doas mysql -u root -p
</pre></div>

<div class="codehilite"><pre><span></span>MariaDB [(none)]&gt; create database misp;
MariaDB [(none)]&gt; grant usage on *.* to misp@localhost identified by &#39;XXXXdbpasswordhereXXXXX&#39;;
MariaDB [(none)]&gt; grant all privileges on misp.* to misp@localhost;
MariaDB [(none)]&gt; flush privileges;
MariaDB [(none)]&gt; exit
</pre></div>

<div class="codehilite"><pre><span></span><span class="c1"># Import the empty MISP database from MYSQL.sql</span>
doas -u www sh -c <span class="s2">&quot;mysql -u misp -p misp &lt; /var/www/htdocs/MISP/INSTALL/MYSQL.sql&quot;</span>
<span class="c1"># enter the password you set previously</span>
</pre></div>

<h3 id="6-apache-configuration-optional">6/ Apache configuration (optional)<a class="headerlink" href="#6-apache-configuration-optional" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># Now configure your Apache webserver with the DocumentRoot /var/www/htdocs/MISP/app/webroot/</span>

<span class="c1">#2.4</span>
doas mkdir /etc/apache2/sites-available/ /etc/apache2/sites-enabled/

<span class="c1"># If the apache version is 2.4:</span>
doas cp /var/www/htdocs/MISP/INSTALL/apache.24.misp.ssl /etc/apache2/sites-available/misp-ssl.conf

<span class="c1"># Be aware that the configuration files for apache 2.4 and up have changed.</span>
<span class="c1"># The configuration file has to have the .conf extension in the sites-available directory</span>
<span class="c1"># For more information, visit http://httpd.apache.org/docs/2.4/upgrading.html</span>

doas mkdir /etc/ssl/private/
<span class="c1"># If a valid SSL certificate is not already created for the server, create a self-signed certificate: (Make sure to fill the &lt;…&gt;)</span>

doas openssl req -newkey rsa:4096 -days <span class="m">3650</span> -nodes -x509 <span class="se">\</span>
-subj <span class="s2">&quot;/C=</span><span class="nv">$OPENSSL_C</span><span class="s2">/ST=</span><span class="nv">$OPENSSL_ST</span><span class="s2">/L=</span><span class="nv">$OPENSSL_L</span><span class="s2">/O=&lt;</span><span class="nv">$OPENSSL_O</span><span class="s2">/OU=</span><span class="nv">$OPENSSL_OU</span><span class="s2">/CN=</span><span class="nv">$OPENSSL_CN</span><span class="s2">/emailAddress=</span><span class="nv">$OPENSSL_EMAILADDRESS</span><span class="s2">&quot;</span> <span class="se">\</span>
-keyout /etc/ssl/private/server.key -out /etc/ssl/server.crt
<span class="c1"># Otherwise, copy the SSLCertificateFile, SSLCertificateKeyFile, and SSLCertificateChainFile to /etc/ssl/private/. (Modify path and config to fit your environment)</span>

doas mkdir /var/log/apache2/
</pre></div>

<div class="codehilite"><pre><span></span>============================================= Begin sample working SSL config for MISP
&lt;VirtualHost &lt;IP, FQDN, or *&gt;:80&gt;
        ServerName &lt;your.FQDN.here&gt;

        Redirect permanent / https://&lt;your.FQDN.here&gt;

        LogLevel warn
        ErrorLog /var/log/apache2/misp.local_error.log
        CustomLog /var/log/apache2/misp.local_access.log combined
        ServerSignature Off
&lt;/VirtualHost&gt;

&lt;VirtualHost &lt;IP, FQDN, or *&gt;:443&gt;
        ServerAdmin admin@&lt;your.FQDN.here&gt;
        ServerName &lt;your.FQDN.here&gt;
        DocumentRoot /var/www/htdocs/MISP/app/webroot
        &lt;Directory /var/www/htdocs/MISP/app/webroot&gt;
                Options -Indexes
                AllowOverride all
                Order allow,deny
                allow from all
        &lt;/Directory&gt;

        SSLEngine On
        SSLCertificateFile /etc/ssl/server.crt
        SSLCertificateKeyFile /etc/ssl/private/server.key
#        SSLCertificateChainFile /etc/ssl/private/misp-chain.crt

        LogLevel warn
        ErrorLog /var/log/apache2/misp.local_error.log
        CustomLog /var/log/apache2/misp.local_access.log combined
        ServerSignature Off
&lt;/VirtualHost&gt;
============================================= End sample working SSL config for MISP
</pre></div>

<div class="codehilite"><pre><span></span><span class="c1"># activate new vhost</span>
<span class="nb">cd</span> /etc/apache2/sites-enabled/
doas ln -s ../sites-available/misp-ssl.conf
<span class="nb">echo</span> <span class="s2">&quot;Include /etc/apache2/sites-enabled/*.conf&quot;</span> <span class="p">|</span>doas tee -a /etc/apache2/httpd2.conf

doas vi /etc/apache2/httpd2.conf
</pre></div>

<div class="codehilite"><pre><span></span>/!\ Enable mod_rewrite in httpd2.conf /!\
LoadModule rewrite_module /usr/local/lib/apache2/mod_rewrite.so
LoadModule ssl_module /usr/local/lib/apache2/mod_ssl.so
LoadModule proxy_module /usr/local/lib/apache2/mod_proxy.so
LoadModule proxy_fcgi_module /usr/local/lib/apache2/mod_proxy_fcgi.so
Listen 443
DirectoryIndex index.php
</pre></div>

<div class="codehilite"><pre><span></span>doas ln -sf /var/www/conf/modules.sample/php-7.0.conf /var/www/conf/modules/php.conf
<span class="c1"># Restart apache</span>
doas /etc/rc.d/apache2 restart
</pre></div>

<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>MISP saves the stdout and stderr of its workers in /var/www/htdocs/MISP/app/tmp/logs</p>
</div>
<h3 id="8-misp-configuration">8/ MISP configuration<a class="headerlink" href="#8-misp-configuration" title="Permanent link">&para;</a></h3>
<hr />
<p><div class="codehilite"><pre><span></span># There are 4 sample configuration files in /var/www/htdocs/MISP/app/Config that need to be copied
doas -u www cp /var/www/htdocs/MISP/app/Config/bootstrap.default.php /var/www/htdocs/MISP/app/Config/bootstrap.php
doas -u www cp /var/www/htdocs/MISP/app/Config/database.default.php /var/www/htdocs/MISP/app/Config/database.php
doas -u www cp /var/www/htdocs/MISP/app/Config/core.default.php /var/www/htdocs/MISP/app/Config/core.php
doas -u www cp /var/www/htdocs/MISP/app/Config/config.default.php /var/www/htdocs/MISP/app/Config/config.php

# Configure the fields in the newly created files:
doas -u www vi /var/www/htdocs/MISP/app/Config/database.php
</pre></div>
<div class="codehilite"><pre><span></span># DATABASE_CONFIG has to be filled
# With the default values provided in section 6, this would look like:
# class DATABASE_CONFIG {
#   public $default = array(
#       &#39;datasource&#39; =&gt; &#39;Database/Mysql&#39;,
#       &#39;persistent&#39; =&gt; false,
#       &#39;host&#39; =&gt; &#39;localhost&#39;,
#       &#39;login&#39; =&gt; &#39;misp&#39;, // grant usage on *.* to misp@localhost
#       &#39;port&#39; =&gt; 3306,
#       &#39;password&#39; =&gt; &#39;XXXXdbpasswordhereXXXXX&#39;, // identified by &#39;XXXXdbpasswordhereXXXXX&#39;;
#       &#39;database&#39; =&gt; &#39;misp&#39;, // create database misp;
#       &#39;prefix&#39; =&gt; &#39;&#39;,
#       &#39;encoding&#39; =&gt; &#39;utf8&#39;,
#   );
#}
</pre></div></p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Important! Change the salt key in /usr/local/www/MISP/app/Config/config.php
The salt key must be a string at least 32 bytes long.
The admin user account will be generated on the first login, make sure that the salt is changed before you create that user
If you forget to do this step, and you are still dealing with a fresh installation, just alter the salt,
delete the user from mysql and log in again using the default admin credentials (<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#97;&#100;&#109;&#105;&#110;&#64;&#97;&#100;&#109;&#105;&#110;&#46;&#116;&#101;&#115;&#116;">&#97;&#100;&#109;&#105;&#110;&#64;&#97;&#100;&#109;&#105;&#110;&#46;&#116;&#101;&#115;&#116;</a> / admin)</p>
</div>
<div class="codehilite"><pre><span></span># Change base url in config.php
doas -u www vi /var/www/htdocs/MISP/app/Config/config.php
# example: &#39;baseurl&#39; =&gt; &#39;https://&lt;your.FQDN.here&gt;&#39;,
# alternatively, you can leave this field empty if you would like to use relative pathing in MISP
# &#39;baseurl&#39; =&gt; &#39;&#39;,

# and make sure the file permissions are still OK
doas chown -R www:www /var/www/htdocs/MISP/app/Config
doas chmod -R 750 /var/www/htdocs/MISP/app/Config

# Generate a GPG encryption key.
export GPG_REAL_NAME=&#39;Autogenerated Key&#39;
export GPG_COMMENT=&#39;WARNING: MISP AutoGenerated Key consider this Key VOID!&#39;
export GPG_EMAIL_ADDRESS=&#39;admin@admin.test&#39;
export GPG_KEY_LENGTH=&#39;2048&#39;
export GPG_PASSPHRASE=&#39;Password1234&#39;
echo &quot;%echo Generating a default key
    Key-Type: default
    Key-Length: $GPG_KEY_LENGTH
    Subkey-Type: default
    Name-Real: $GPG_REAL_NAME
    Name-Comment: $GPG_COMMENT
    Name-Email: $GPG_EMAIL_ADDRESS
    Expire-Date: 0
    Passphrase: $GPG_PASSPHRASE
    # Do a commit here, so that we can later print &quot;done&quot;
    %commit
%echo done&quot; &gt; /tmp/gen-key-script
doas -u www mkdir /var/www/htdocs/MISP/.gnupg
doas chmod 700 /var/www/htdocs/MISP/.gnupg
doas gpg2 --homedir /var/www/htdocs/MISP/.gnupg --batch --gen-key /tmp/gen-key-script
# The email address should match the one set in the config.php / set in the configuration menu in the administration menu configuration file

# And export the public key to the webroot
doas sh -c &quot;gpg2 --homedir /var/www/htdocs/MISP/.gnupg --export --armor $GPG_EMAIL_ADDRESS &gt; /var/www/htdocs/MISP/app/webroot/gpg.asc&quot;

# To make the background workers start on boot
doas chmod +x /var/www/htdocs/MISP/app/Console/worker/start.sh
doas vi /etc/rc.local
# Add the following line before the last line (exit 0). Make sure that you replace www with your apache user:
doas -u www bash /var/www/htdocs/MISP/app/Console/worker/start.sh

# Now log in using the webinterface:
# The default user/pass = admin@admin.test/admin

# Using the server settings tool in the admin interface (Administration -&gt; Server Settings), set MISP up to your preference
# It is especially vital that no critical issues remain!
# start the workers by navigating to the workers tab and clicking restart all workers

# Don&#39;t forget to change the email, password and authentication key after installation.

# Once done, have a look at the diagnostics

# If any of the directories that MISP uses to store files is not writeable to the apache user, change the permissions
# you can do this by running the following commands:

doas chmod -R 750 /var/www/htdocs/MISP/&lt;directory path with an indicated issue&gt;
doas chown -R www:www /var/www/htdocs/MISP/&lt;directory path with an indicated issue&gt;
</pre></div>

<h4 id="misp-modules">MISP Modules<a class="headerlink" href="#misp-modules" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas pkg_add -v jpeg yara
cd /usr/local/src/
git clone https://github.com/MISP/misp-modules.git
cd misp-modules
# pip3 install
doas /usr/local/virtualenvs/MISP/bin/pip install -I -r REQUIREMENTS
doas /usr/local/virtualenvs/MISP/bin/pip install -I .
doas /usr/local/virtualenvs/MISP/bin/pip install git+https://github.com/VirusTotal/yara-python.git
doas /usr/local/virtualenvs/MISP/bin/pip install wand
##doas gem install pygments.rb
##doas gem install asciidoctor-pdf --pre
doas -u www /usr/local/virtualenvs/MISP/bin/misp-modules -l 0.0.0.0 -s &amp;
echo &quot;doas -u www /usr/local/virtualenvs/MISP/bin/misp-modules -l 0.0.0.0 -s &amp;&quot; |doas tee -a /etc/rc.local
</pre></div>

<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Make sure that the STIX libraries and GnuPG work as intended, if not, refer to INSTALL.txt's paragraphs dealing with these two items</p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>If anything goes wrong, make sure that you check MISP's logs for errors:
/var/www/htdocs/MISP/app/tmp/logs/error.log
/var/www/htdocs/MISP/app/tmp/logs/resque-worker-error.log
/var/www/htdocs/MISP/app/tmp/logs/resque-scheduler-error.log
/var/www/htdocs/MISP/app/tmp/logs/resque-2015-01-01.log // where the actual date is the current date</p>
</div>
<h4 id="misp-config-automation">MISP Config Automation<a class="headerlink" href="#misp-config-automation" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas <span class="nv">$CAKE</span> Live <span class="nv">$MISP_LIVE</span>
<span class="nv">AUTH_KEY</span><span class="o">=</span><span class="k">$(</span>mysql -u misp -p misp -e <span class="s2">&quot;SELECT authkey FROM users;&quot;</span> <span class="p">|</span> tail -1<span class="k">)</span>
<span class="c1"># Update the galaxies…</span>
doas <span class="nv">$CAKE</span> Admin updateGalaxies

<span class="c1"># Updating the taxonomies…</span>
doas <span class="nv">$CAKE</span> Admin updateTaxonomies

<span class="c1"># Updating the warning lists…</span>
doas <span class="nv">$CAKE</span> Admin updateWarningLists

<span class="c1"># Updating the notice lists…</span>
<span class="c1">## doas $CAKE Admin updateNoticeLists</span>
curl --header <span class="s2">&quot;Authorization: </span><span class="nv">$AUTH_KEY</span><span class="s2">&quot;</span> --header <span class="s2">&quot;Accept: application/json&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -k -X POST https://127.0.0.1/noticelists/update

<span class="c1"># Updating the object templates…</span>
<span class="c1">##doas $CAKE Admin updateObjectTemplates</span>
curl --header <span class="s2">&quot;Authorization: </span><span class="nv">$AUTH_KEY</span><span class="s2">&quot;</span> --header <span class="s2">&quot;Accept: application/json&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -k -X POST https://127.0.0.1/objectTemplates/update

<span class="c1"># Tune global time outs</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Session.autoRegenerate&quot;</span> <span class="m">0</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Session.timeout&quot;</span> <span class="m">600</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Session.cookie_timeout&quot;</span> <span class="m">3600</span>

<span class="c1"># Enable GnuPG</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;GnuPG.email&quot;</span> <span class="s2">&quot;admin@admin.test&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;GnuPG.homedir&quot;</span> <span class="s2">&quot;</span><span class="nv">$PATH_TO_MISP</span><span class="s2">/.gnupg&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;GnuPG.password&quot;</span> <span class="s2">&quot;Password1234&quot;</span>

<span class="c1"># Enable Enrichment set better timeouts</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Enrichment_services_enable&quot;</span> <span class="nb">true</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Enrichment_hover_enable&quot;</span> <span class="nb">true</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Enrichment_timeout&quot;</span> <span class="m">300</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Enrichment_hover_timeout&quot;</span> <span class="m">150</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Enrichment_cve_enabled&quot;</span> <span class="nb">true</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Enrichment_dns_enabled&quot;</span> <span class="nb">true</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Enrichment_services_url&quot;</span> <span class="s2">&quot;http://127.0.0.1&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Enrichment_services_port&quot;</span> <span class="m">6666</span>

<span class="c1"># Enable Import modules set better timout</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Import_services_enable&quot;</span> <span class="nb">true</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Import_services_url&quot;</span> <span class="s2">&quot;http://127.0.0.1&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Import_services_port&quot;</span> <span class="m">6666</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Import_timeout&quot;</span> <span class="m">300</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Import_ocr_enabled&quot;</span> <span class="nb">true</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Import_csvimport_enabled&quot;</span> <span class="nb">true</span>

<span class="c1"># Enable Export modules set better timout</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Export_services_enable&quot;</span> <span class="nb">true</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Export_services_url&quot;</span> <span class="s2">&quot;http://127.0.0.1&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Export_services_port&quot;</span> <span class="m">6666</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Export_timeout&quot;</span> <span class="m">300</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Export_pdfexport_enabled&quot;</span> <span class="nb">true</span>

<span class="c1"># Enable installer org and tune some configurables</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.host_org_id&quot;</span> <span class="m">1</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.email&quot;</span> <span class="s2">&quot;info@admin.test&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.disable_emailing&quot;</span> <span class="nb">true</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.contact&quot;</span> <span class="s2">&quot;info@admin.test&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.disablerestalert&quot;</span> <span class="nb">true</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.showCorrelationsOnIndex&quot;</span> <span class="nb">true</span>

<span class="c1"># Provisional Cortex tunes</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_services_enable&quot;</span> <span class="nb">false</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_services_url&quot;</span> <span class="s2">&quot;http://127.0.0.1&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_services_port&quot;</span> <span class="m">9000</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_timeout&quot;</span> <span class="m">120</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_services_url&quot;</span> <span class="s2">&quot;http://127.0.0.1&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_services_port&quot;</span> <span class="m">9000</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_services_timeout&quot;</span> <span class="m">120</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_services_authkey&quot;</span> <span class="s2">&quot;&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_ssl_verify_peer&quot;</span> <span class="nb">false</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_ssl_verify_host&quot;</span> <span class="nb">false</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Cortex_ssl_allow_self_signed&quot;</span> <span class="nb">true</span>

<span class="c1"># Various plugin sightings settings</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Sightings_policy&quot;</span> <span class="m">0</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Sightings_anonymise&quot;</span> <span class="nb">false</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.Sightings_range&quot;</span> <span class="m">365</span>

<span class="c1"># Plugin CustomAuth tuneable</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.CustomAuth_disable_logout&quot;</span> <span class="nb">false</span>

<span class="c1"># RPZ Plugin settings</span>

doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_policy&quot;</span> <span class="s2">&quot;DROP&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_walled_garden&quot;</span> <span class="s2">&quot;127.0.0.1&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_serial&quot;</span> <span class="s2">&quot;\$date00&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_refresh&quot;</span> <span class="s2">&quot;2h&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_retry&quot;</span> <span class="s2">&quot;30m&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_expiry&quot;</span> <span class="s2">&quot;30d&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_minimum_ttl&quot;</span> <span class="s2">&quot;1h&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_ttl&quot;</span> <span class="s2">&quot;1w&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_ns&quot;</span> <span class="s2">&quot;localhost.&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_ns_alt&quot;</span> <span class="s2">&quot;&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Plugin.RPZ_email&quot;</span> <span class="s2">&quot;root.localhost&quot;</span>

<span class="c1"># Force defaults to make MISP Server Settings less RED</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.language&quot;</span> <span class="s2">&quot;eng&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.proposals_block_attributes&quot;</span> <span class="nb">false</span>

<span class="c1">## Redis block</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.redis_host&quot;</span> <span class="s2">&quot;127.0.0.1&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.redis_port&quot;</span> <span class="m">6379</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.redis_database&quot;</span> <span class="m">13</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.redis_password&quot;</span> <span class="s2">&quot;&quot;</span>

<span class="c1"># Force defaults to make MISP Server Settings less YELLOW</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.ssdeep_correlation_threshold&quot;</span> <span class="m">40</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.extended_alert_subject&quot;</span> <span class="nb">false</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.default_event_threat_level&quot;</span> <span class="m">4</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.newUserText&quot;</span> <span class="s2">&quot;Dear new MISP user,\\n\\nWe would hereby like to welcome you to the \$org MISP community.\\n\\n Use the credentials below to log into MISP at \$misp, where you will be prompted to manually change your password to something of your own choice.\\n\\nUsername: \$username\\nPassword: \$password\\n\\nIf you have any questions, don&#39;t hesitate to contact us at: \$contact.\\n\\nBest regards,\\nYour \$org MISP support team&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.passwordResetText&quot;</span> <span class="s2">&quot;Dear MISP user,\\n\\nA password reset has been triggered for your account. Use the below provided temporary password to log into MISP at \$misp, where you will be prompted to manually change your password to something of your own choice.\\n\\nUsername: \$username\\nYour temporary password: \$password\\n\\nIf you have any questions, don&#39;t hesitate to contact us at: \$contact.\\n\\nBest regards,\\nYour \$org MISP support team&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.enableEventBlacklisting&quot;</span> <span class="nb">true</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.enableOrgBlacklisting&quot;</span> <span class="nb">true</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.log_client_ip&quot;</span> <span class="nb">false</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.log_auth&quot;</span> <span class="nb">false</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.disableUserSelfManagement&quot;</span> <span class="nb">false</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.block_event_alert&quot;</span> <span class="nb">false</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.block_event_alert_tag&quot;</span> <span class="s2">&quot;no-alerts=\&quot;true\&quot;&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.block_old_event_alert&quot;</span> <span class="nb">false</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.block_old_event_alert_age&quot;</span> <span class="s2">&quot;&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.incoming_tags_disabled_by_default&quot;</span> <span class="nb">false</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.footermidleft&quot;</span> <span class="s2">&quot;This is an initial install&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.footermidright&quot;</span> <span class="s2">&quot;Please configure and harden accordingly&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.welcome_text_top&quot;</span> <span class="s2">&quot;Initial Install, please configure&quot;</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.welcome_text_bottom&quot;</span> <span class="s2">&quot;Welcome to MISP, change this message in MISP Settings&quot;</span>

<span class="c1"># Force defaults to make MISP Server Settings less GREEN</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Security.password_policy_length&quot;</span> <span class="m">12</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Security.password_policy_complexity&quot;</span> <span class="s1">&#39;/^((?=.*\d)|(?=.*\W+))(?![\n])(?=.*[A-Z])(?=.*[a-z]).*$|.{16,}/&#39;</span>
<span class="c1"># Tune global time outs</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Session.autoRegenerate&quot;</span> <span class="m">0</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Session.timeout&quot;</span> <span class="m">600</span>
doas <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;Session.cookie_timeout&quot;</span> <span class="m">3600</span>
</pre></div>

<h3 id="recommended-actions">Recommended actions<a class="headerlink" href="#recommended-actions" title="Permanent link">&para;</a></h3>
<hr />
<ul>
<li>
<p>By default CakePHP exposes its name and version in email headers. Apply a patch to remove this behavior.</p>
</li>
<li>
<p>You should really harden your OS</p>
</li>
<li>You should really harden the configuration of Apache/httpd</li>
<li>You should really harden the configuration of MySQL/MariaDB</li>
<li>Keep your software up2date (OS, MISP, CakePHP and everything else)</li>
<li>Log and audit</li>
</ul>
<h3 id="optional-features">Optional features<a class="headerlink" href="#optional-features" title="Permanent link">&para;</a></h3>
<hr />
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>MISP has a pub/sub feature, using ZeroMQ.</p>
</div>
<h4 id="zeromq-depends-on-the-python-client-for-redis">ZeroMQ depends on the Python client for Redis<a class="headerlink" href="#zeromq-depends-on-the-python-client-for-redis" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>doas pkg_add -v py3-zmq zeromq
doas /usr/local/virtualenvs/MISP/bin/pip install pyzmq
</pre></div>

<h4 id="misp-dashboard">misp-dashboard<a class="headerlink" href="#misp-dashboard" title="Permanent link">&para;</a></h4>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Enable ZeroMQ for misp-dashboard</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This still needs more testing, it runs but no data is showing.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The install_dependencies.sh script is for Linux ONLY. The following blurp will be a diff of a working OpenBSD version.</p>
</div>
<div class="codehilite"><pre><span></span>(DASHENV) obsd# diff -u install_dependencies.sh install_dependencies_obsd.sh  
<span class="gd">--- install_dependencies.sh     Fri Oct 19 12:14:38 2018</span>
<span class="gi">+++ install_dependencies_obsd.sh        Fri Oct 19 12:43:22 2018</span>
<span class="gu">@@ -1,14 +1,14 @@</span>
<span class="gd">-#!/bin/bash</span>
<span class="gi">+#!/usr/local/bin/bash</span>

 set -e
 #set -x

<span class="gd">-sudo apt-get install python3-virtualenv virtualenv screen redis-server unzip -y</span>
<span class="gi">+doas pkg_add -v unzip wget</span>

 if [ -z &quot;$VIRTUAL_ENV&quot; ]; then
<span class="gd">-    virtualenv -p python3 DASHENV</span>
<span class="gi">+    virtualenv -p python3 /usr/local/virtualenvs/DASHENV</span>

<span class="gd">-    . ./DASHENV/bin/activate</span>
<span class="gi">+    . /usr/local/virtualenvs/DASHENV/bin/activate</span>
 fi

 pip3 install -U pip argparse redis zmq geoip2 flask phonenumbers pycountry
</pre></div>

<div class="codehilite"><pre><span></span>cd /var/www
doas mkdir misp-dashboard
doas chown www:www misp-dashboard
doas -u www git clone https://github.com/MISP/misp-dashboard.git
cd misp-dashboard
#/!\ Made on Linux, the next script will fail
#doas /var/www/misp-dashboard/install_dependencies.sh
doas virtualenv -ppython3 /usr/local/virtualenvs/DASHENV
doas /usr/local/virtualenvs/DASHENV/bin/pip install -U pip argparse redis zmq geoip2 flask phonenumbers pycountry

doas sed -i &quot;s/^host\ =\ localhost/host\ =\ 0.0.0.0/g&quot; /var/www/misp-dashboard/config/config.cfg
doas sed -i -e &#39;$i \doas -u www bash /var/www/misp-dashboard/start_all.sh\n&#39; /etc/rc.local
#/!\ Add port 8001 as a listener
#doas sed -i &#39;/Listen 80/a Listen 0.0.0.0:8001&#39; /etc/apache2/ports.conf
doas pkg_add -v ap2-mod_wsgi

echo &quot;&lt;VirtualHost *:8001&gt;
    ServerAdmin admin@misp.local
    ServerName misp.local
    DocumentRoot /var/www/misp-dashboard

    WSGIDaemonProcess misp-dashboard \
       user=misp group=misp \
       python-home=/var/www/misp-dashboard/DASHENV \
       processes=1 \
       threads=15 \
       maximum-requests=5000 \
       listen-backlog=100 \
       queue-timeout=45 \
       socket-timeout=60 \
       connect-timeout=15 \
       request-timeout=60 \
       inactivity-timeout=0 \
       deadlock-timeout=60 \
       graceful-timeout=15 \
       eviction-timeout=0 \
       shutdown-timeout=5 \
       send-buffer-size=0 \
       receive-buffer-size=0 \
       header-buffer-size=0 \
       response-buffer-size=0 \
       server-metrics=Off
    WSGIScriptAlias / /var/www/misp-dashboard/misp-dashboard.wsgi
    &lt;Directory /var/www/misp-dashboard&gt;
        WSGIProcessGroup misp-dashboard
        WSGIApplicationGroup %{GLOBAL}
        Require all granted
    &lt;/Directory&gt;
    LogLevel info
    ErrorLog /var/log/apache2/misp-dashboard.local_error.log
    CustomLog /var/log/apache2/misp-dashboard.local_access.log combined
    ServerSignature Off
&lt;/VirtualHost&gt;&quot; | doas tee /etc/apache2/sites-available/misp-dashboard.conf

doas ln -s /etc/apache2/sites-available/misp-dashboard.conf /etc/apache2/sites-enabled/misp-dashboard.conf
</pre></div>

<p>Add this to /etc/httpd2.conf
<div class="codehilite"><pre><span></span>LoadModule wsgi_module /usr/local/lib/apache2/mod_wsgi.so
Listen 8001
</pre></div></p>
<div class="codehilite"><pre><span></span>doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_enable&quot; true
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_event_notifications_enable&quot; true
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_object_notifications_enable&quot; true
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_object_reference_notifications_enable&quot; true
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_attribute_notifications_enable&quot; true
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_sighting_notifications_enable&quot; true
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_user_notifications_enable&quot; true
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_organisation_notifications_enable&quot; true
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_port&quot; 50000
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_redis_host&quot; &quot;localhost&quot;
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_redis_port&quot; 6379
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_redis_database&quot; 1
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_redis_namespace&quot; &quot;mispq&quot;
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_include_attachments&quot; false
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_tag_notifications_enable&quot; false
doas $CAKE Admin setSetting &quot;Plugin.ZeroMQ_audit_notifications_enable&quot; false
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../xINSTALL.debian9-postgresql/" title="Debian 9 \w postgresql" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Debian 9 \w postgresql
              </span>
            </div>
          </a>
        
        
          <a href="../xINSTALL.rhel7/" title="Redhat Enterprise Linux 7.6 (BETA)" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Redhat Enterprise Linux 7.6 (BETA)
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 MISP Project
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://www.misp-project.org/" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/MISP" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/MISPProject" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>