



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="MISP Project - Install Guides">
      
      
        <link rel="canonical" href="https://www.misp-project.org/xINSTALL.centos6/">
      
      
        <meta name="author" content="MISP Project">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Centos 6 - MISP Install Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#installation-instructions" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.misp-project.org/" title="MISP Install Documentation" class="md-header-nav__button md-logo">
          
            <img src="../img/misp.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                MISP Install Documentation
              </span>
              <span class="md-header-nav__topic">
                Centos 6
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/MISP/MISP" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      MISP/MISP
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.misp-project.org/" title="MISP Install Documentation" class="md-nav__button md-logo">
      
        <img src="../img/misp.png" width="48" height="48">
      
    </a>
    MISP Install Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/MISP/MISP" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      MISP/MISP
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Install Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Install Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.ubuntu1804/" title="Ubuntu 18.04" class="md-nav__link">
      Ubuntu 18.04
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.debian9/" title="Debian stable" class="md-nav__link">
      Debian stable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.kali/" title="Kali Linux" class="md-nav__link">
      Kali Linux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../INSTALL.rhel7/" title="Redhat Enterprise Linux 7" class="md-nav__link">
      Redhat Enterprise Linux 7
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      xInstall Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        xInstall Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL/" title="Warning" class="md-nav__link">
      Warning
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Centos 6
      </label>
    
    <a href="./" title="Centos 6" class="md-nav__link md-nav__link--active">
      Centos 6
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#for-centos-6x" title="for CentOS 6.x" class="md-nav__link">
    for CentOS 6.x
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0-misp-centos-6-minimal-netinstall-status" title="0/ MISP CentOS 6 Minimal NetInstall - Status" class="md-nav__link">
    0/ MISP CentOS 6 Minimal NetInstall - Status
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misp-configuration-variables" title="MISP configuration variables" class="md-nav__link">
    MISP configuration variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-minimal-centos-install" title="1/ Minimal CentOS install" class="md-nav__link">
    1/ Minimal CentOS install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-dependencies" title="2/ Dependencies *" class="md-nav__link">
    2/ Dependencies *
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-misp-code" title="3/ MISP code" class="md-nav__link">
    3/ MISP code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-cakephp" title="4/ CakePHP" class="md-nav__link">
    4/ CakePHP
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cakephp-is-now-included-as-a-submodule-of-misp-and-has-been-fetch-by-a-previous-step" title="CakePHP is now included as a submodule of MISP and has been fetch by a previous step." class="md-nav__link">
    CakePHP is now included as a submodule of MISP and has been fetch by a previous step.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-cakeresque-along-with-its-dependencies-if-you-intend-to-use-the-built-in-background-jobs" title="Install CakeResque along with its dependencies if you intend to use the built in background jobs." class="md-nav__link">
    Install CakeResque along with its dependencies if you intend to use the built in background jobs.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-set-the-permissions" title="5/ Set the permissions" class="md-nav__link">
    5/ Set the permissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-create-a-database-and-user" title="6/ Create a database and user" class="md-nav__link">
    6/ Create a database and user
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#copypaste" title="copy/paste:" class="md-nav__link">
    copy/paste:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-the-empty-mysql-database-from-mysqlsql" title="Import the empty MySQL database from MYSQL.sql" class="md-nav__link">
    Import the empty MySQL database from MYSQL.sql
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-apache-configuration" title="7/ Apache configuration" class="md-nav__link">
    7/ Apache configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-log-rotation" title="8/ Log rotation" class="md-nav__link">
    8/ Log rotation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-misp-configuration" title="9/ MISP configuration" class="md-nav__link">
    9/ MISP configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialize-misp-configuration-and-set-some-defaults" title="Initialize MISP configuration and set some defaults" class="md-nav__link">
    Initialize MISP configuration and set some defaults
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recommended-actions" title="Recommended actions" class="md-nav__link">
    Recommended actions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.centos7/" title="Centos 7" class="md-nav__link">
      Centos 7
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.debian_testing/" title="Debian testing" class="md-nav__link">
      Debian testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.debian9-postgresql/" title="Debian 9 \w postgresql" class="md-nav__link">
      Debian 9 \w postgresql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.ubuntu1804.with.webmin/" title="Ubuntu 18.04 \w webmin" class="md-nav__link">
      Ubuntu 18.04 \w webmin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.tsurugi/" title="Tsurugi Linux" class="md-nav__link">
      Tsurugi Linux
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.OpenBSD/" title="OpenBSD 6.4" class="md-nav__link">
      OpenBSD 6.4
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xINSTALL.rhel7/" title="Redhat Enterprise Linux 7.6 (BETA)" class="md-nav__link">
      Redhat Enterprise Linux 7.6 (BETA)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Config Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Config Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CONFIG.elasticsearch-logging/" title="Elastic Search Logging" class="md-nav__link">
      Elastic Search Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CONFIG.s3-attachments/" title="Amazon S3 attachments" class="md-nav__link">
      Amazon S3 attachments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../CONFIG.SMIME/" title="S/MIME" class="md-nav__link">
      S/MIME
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../UPDATE/" title="Update MISP" class="md-nav__link">
      Update MISP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../UPGRADE/" title="Upgrading MISP" class="md-nav__link">
      Upgrading MISP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Old guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Old guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../archive/old-2_3to2_4-UPGRADE/" title="2.3 to 2.4 upgrade" class="md-nav__link">
      2.3 to 2.4 upgrade
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../archive/INSTALL.ubuntu1604/" title="Ubuntu 16.04" class="md-nav__link">
      Ubuntu 16.04
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../archive/xINSTALL.FreeBSD/" title="FreeBSD" class="md-nav__link">
      FreeBSD
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Changelog/" title="MISP Release Notes" class="md-nav__link">
      MISP Release Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#for-centos-6x" title="for CentOS 6.x" class="md-nav__link">
    for CentOS 6.x
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0-misp-centos-6-minimal-netinstall-status" title="0/ MISP CentOS 6 Minimal NetInstall - Status" class="md-nav__link">
    0/ MISP CentOS 6 Minimal NetInstall - Status
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#misp-configuration-variables" title="MISP configuration variables" class="md-nav__link">
    MISP configuration variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-minimal-centos-install" title="1/ Minimal CentOS install" class="md-nav__link">
    1/ Minimal CentOS install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-dependencies" title="2/ Dependencies *" class="md-nav__link">
    2/ Dependencies *
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-misp-code" title="3/ MISP code" class="md-nav__link">
    3/ MISP code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-cakephp" title="4/ CakePHP" class="md-nav__link">
    4/ CakePHP
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cakephp-is-now-included-as-a-submodule-of-misp-and-has-been-fetch-by-a-previous-step" title="CakePHP is now included as a submodule of MISP and has been fetch by a previous step." class="md-nav__link">
    CakePHP is now included as a submodule of MISP and has been fetch by a previous step.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-cakeresque-along-with-its-dependencies-if-you-intend-to-use-the-built-in-background-jobs" title="Install CakeResque along with its dependencies if you intend to use the built in background jobs." class="md-nav__link">
    Install CakeResque along with its dependencies if you intend to use the built in background jobs.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-set-the-permissions" title="5/ Set the permissions" class="md-nav__link">
    5/ Set the permissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-create-a-database-and-user" title="6/ Create a database and user" class="md-nav__link">
    6/ Create a database and user
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#copypaste" title="copy/paste:" class="md-nav__link">
    copy/paste:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-the-empty-mysql-database-from-mysqlsql" title="Import the empty MySQL database from MYSQL.sql" class="md-nav__link">
    Import the empty MySQL database from MYSQL.sql
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-apache-configuration" title="7/ Apache configuration" class="md-nav__link">
    7/ Apache configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-log-rotation" title="8/ Log rotation" class="md-nav__link">
    8/ Log rotation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-misp-configuration" title="9/ MISP configuration" class="md-nav__link">
    9/ MISP configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialize-misp-configuration-and-set-some-defaults" title="Initialize MISP configuration and set some defaults" class="md-nav__link">
    Initialize MISP configuration and set some defaults
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recommended-actions" title="Recommended actions" class="md-nav__link">
    Recommended actions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="installation-instructions">INSTALLATION INSTRUCTIONS<a class="headerlink" href="#installation-instructions" title="Permanent link">&para;</a></h1>
<h2 id="for-centos-6x">for CentOS 6.x<a class="headerlink" href="#for-centos-6x" title="Permanent link">&para;</a></h2>
<h3 id="0-misp-centos-6-minimal-netinstall-status">0/ MISP CentOS 6 Minimal NetInstall - Status<a class="headerlink" href="#0-misp-centos-6-minimal-netinstall-status" title="Permanent link">&para;</a></h3>
<hr />
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Maintained and tested by the community.<br />
Parts of the installation procedures can also be found in the automatic VM generator script <a href="https://github.com/MISP/misp-packer/blob/18.04/scripts/bootstrap.sh">bootstrap.sh</a> of misp-packer.</p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>There are technically only minor differences between CentOS and RHEL.<br />
For more information on what might differ, <a href="https://unix.stackexchange.com/questions/27323/is-centos-exactly-the-same-as-rhel">this StackExchange</a> question might answer some questions.</p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Semi-maintained and tested by @SteveClement, CentOS 6.10 on 20181025<br />
It is still considered experimental as not everything works seemlessly.</p>
</div>
<p>CentOS 6.10 <a href="http://mirrors.sonic.net/centos/6.10/os/x86_64/">NetInstallURL</a></p>
<h4 id="misp-configuration-variables">MISP configuration variables<a class="headerlink" href="#misp-configuration-variables" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="c1"># &lt;snippet-begin 0_global-vars.sh&gt;</span>
MISPvars <span class="o">()</span> <span class="o">{</span>
  debug <span class="s2">&quot;Setting generic </span><span class="si">${</span><span class="nv">LBLUE</span><span class="si">}</span><span class="s2">MISP</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2"> variables shared by all flavours&quot;</span>
  <span class="c1"># Local non-root MISP user</span>
  <span class="nv">MISP_USER</span><span class="o">=</span><span class="s1">&#39;misp&#39;</span>
  <span class="nv">MISP_PASSWORD</span><span class="o">=</span><span class="s1">&#39;Password1234&#39;</span>

  <span class="c1"># The web server user</span>
  <span class="nv">WWW_USER</span><span class="o">=</span><span class="s2">&quot;www-data&quot;</span>

  <span class="c1"># MISP configuration variables</span>
  <span class="nv">PATH_TO_MISP</span><span class="o">=</span><span class="s1">&#39;/var/www/MISP&#39;</span>

  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$FQDN</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">FQDN</span><span class="o">=</span><span class="s2">&quot;misp.local&quot;</span>
  <span class="k">fi</span>

  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$MISP_BASEURL</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">MISP_BASEURL</span><span class="o">=</span><span class="s1">&#39;&quot;&quot;&#39;</span>
  <span class="k">fi</span>

  <span class="nv">MISP_LIVE</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>

  <span class="c1"># Database configuration</span>
  <span class="nv">DBHOST</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span>
  <span class="nv">DBNAME</span><span class="o">=</span><span class="s1">&#39;misp&#39;</span>
  <span class="nv">DBUSER_ADMIN</span><span class="o">=</span><span class="s1">&#39;root&#39;</span>
  <span class="nv">DBPASSWORD_ADMIN</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>openssl rand -hex <span class="m">32</span><span class="k">)</span><span class="s2">&quot;</span>
  <span class="nv">DBUSER_MISP</span><span class="o">=</span><span class="s1">&#39;misp&#39;</span>
  <span class="nv">DBPASSWORD_MISP</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>openssl rand -hex <span class="m">32</span><span class="k">)</span><span class="s2">&quot;</span>

  <span class="c1"># OpenSSL configuration</span>
  <span class="nv">OPENSSL_CN</span><span class="o">=</span><span class="nv">$FQDN</span>
  <span class="nv">OPENSSL_C</span><span class="o">=</span><span class="s1">&#39;LU&#39;</span>
  <span class="nv">OPENSSL_ST</span><span class="o">=</span><span class="s1">&#39;State&#39;</span>
  <span class="nv">OPENSSL_L</span><span class="o">=</span><span class="s1">&#39;Location&#39;</span>
  <span class="nv">OPENSSL_O</span><span class="o">=</span><span class="s1">&#39;Organization&#39;</span>
  <span class="nv">OPENSSL_OU</span><span class="o">=</span><span class="s1">&#39;Organizational Unit&#39;</span>
  <span class="nv">OPENSSL_EMAILADDRESS</span><span class="o">=</span><span class="s2">&quot;info@</span><span class="nv">$FQDN</span><span class="s2">&quot;</span>

  <span class="c1"># GPG configuration</span>
  <span class="nv">GPG_REAL_NAME</span><span class="o">=</span><span class="s1">&#39;Autogenerated Key&#39;</span>
  <span class="nv">GPG_COMMENT</span><span class="o">=</span><span class="s1">&#39;WARNING: MISP AutoGenerated Key consider this Key VOID!&#39;</span>
  <span class="nv">GPG_EMAIL_ADDRESS</span><span class="o">=</span><span class="s1">&#39;admin@admin.test&#39;</span>
  <span class="nv">GPG_KEY_LENGTH</span><span class="o">=</span><span class="s1">&#39;2048&#39;</span>
  <span class="nv">GPG_PASSPHRASE</span><span class="o">=</span><span class="s1">&#39;Password1234&#39;</span>

  <span class="c1"># debug alias to make sure people are not confused when blindly copy pasting blobs of code</span>
  <span class="nb">alias</span> <span class="nv">debug</span><span class="o">=</span><span class="s2">&quot;echo -e&quot;</span>

  <span class="c1"># checkAptLock alias to make sure people are not confused when blindly copy pasting blobs of code</span>
  <span class="nb">alias</span> <span class="nv">checkAptLock</span><span class="o">=</span><span class="s2">&quot;echo &#39;Function used in Installer to make sure apt is not locked&#39;&quot;</span>

  <span class="c1"># php.ini configuration</span>
  <span class="nv">upload_max_filesize</span><span class="o">=</span>50M
  <span class="nv">post_max_size</span><span class="o">=</span>50M
  <span class="nv">max_execution_time</span><span class="o">=</span><span class="m">300</span>
  <span class="nv">memory_limit</span><span class="o">=</span>512M

  <span class="nv">CAKE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PATH_TO_MISP</span><span class="s2">/app/Console/cake&quot;</span>

  <span class="c1"># sudo config to run $LUSER commands</span>
  <span class="nv">SUDO_USER</span><span class="o">=</span><span class="s2">&quot;sudo -H -u </span><span class="si">${</span><span class="nv">MISP_USER</span><span class="si">}</span><span class="s2"> &quot;</span>
  <span class="nv">SUDO_WWW</span><span class="o">=</span><span class="s2">&quot;sudo -H -u </span><span class="si">${</span><span class="nv">WWW_USER</span><span class="si">}</span><span class="s2"> &quot;</span>

  <span class="nb">echo</span> <span class="s2">&quot;The following DB Passwords were generated...&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;Admin (</span><span class="si">${</span><span class="nv">DBUSER_ADMIN</span><span class="si">}</span><span class="s2">) DB Password: </span><span class="si">${</span><span class="nv">DBPASSWORD_ADMIN</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;User  (</span><span class="si">${</span><span class="nv">DBUSER_MISP</span><span class="si">}</span><span class="s2">) DB Password: </span><span class="si">${</span><span class="nv">DBPASSWORD_MISP</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">}</span>
<span class="c1"># &lt;snippet-end 0_global-vars.sh&gt;</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="c1"># CentOS Specific</span>
<span class="nv">RUN_PHP</span><span class="o">=</span><span class="s1">&#39;/usr/bin/scl enable rh-php70 &#39;</span>
<span class="nv">RUN_PYTHON</span><span class="o">=</span><span class="s1">&#39;/usr/bin/scl enable rh-python36 &#39;</span>

<span class="nv">PHP_INI</span><span class="o">=</span>/etc/opt/rh/rh-php70/php.ini
</pre></div>

<h3 id="1-minimal-centos-install">1/ Minimal CentOS install<a class="headerlink" href="#1-minimal-centos-install" title="Permanent link">&para;</a></h3>
<hr />
<p>Install a minimal CentOS 6.x system with the software:</p>
<ul>
<li>OpenSSH server</li>
<li>LAMP server (actually, this is done below)</li>
<li>Mail server</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># Make sure you set your hostname CORRECTLY vs. like an brute (manually in /etc/hostname)</span>
sudo hostnamectl set-hostname misp.local <span class="c1"># or whatever you want it to be</span>

<span class="c1"># Make sure your system is up2date:</span>
sudo yum update -y
</pre></div>

<h3 id="2-dependencies">2/ Dependencies *<a class="headerlink" href="#2-dependencies" title="Permanent link">&para;</a></h3>
<hr />
<p>Once the system is installed you can perform the following steps as root or with sudo.</p>
<div class="codehilite"><pre><span></span><span class="c1"># We need some packages from the Extra Packages for Enterprise Linux repository</span>
curl -o /tmp/epel.rpm http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
sudo rpm -Uvh /tmp/epel.rpm

<span class="c1"># Since MISP 2.4 PHP 5.5 is a minimal requirement, so we need a newer version than CentOS base provides</span>
<span class="c1"># Software Collections is a way do to this, see https://wiki.centos.org/AdditionalResources/Repositories/SCL</span>
sudo yum install centos-release-scl -y

<span class="c1"># Because vim is just so practical</span>
sudo yum install vim -y

<span class="c1"># Install the dependencies:</span>
sudo yum install gcc git httpd zip redis mysql-server python-devel python-pip libxslt-devel zlib-devel -y

<span class="c1"># Install PHP 7.0 from SCL, see https://www.softwarecollections.org/en/scls/rhscl/rh-php70/</span>
sudo yum install rh-php70 rh-php70-php-fpm rh-php70-php-devel rh-php70-php-mysqlnd rh-php70-php-mbstring rh-php70-php-xml rh-php70-php-bcmath

<span class="c1"># Install Python 3.6 from SCL, see https://www.softwarecollections.org/en/scls/rhscl/rh-python36/</span>
sudo yum install rh-python36 -y

<span class="c1"># rh-php70-php only provided mod_php for httpd24-httpd from SCL</span>
<span class="c1"># if we want to use httpd from CentOS base we can use rh-php70-php-fpm instead</span>
sudo chkconfig rh-php70-php-fpm on
sudo service rh-php70-php-fpm start

<span class="c1"># php-fpm is accessed using the fcgi interface</span>
sudo yum install mod_fcgid mod_proxy_fcgi
</pre></div>

<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>$RUN_PHP makes php available for you if using rh-php70. e.g: $RUN_PHP "pear list | grep Crypt_GPG"</p>
</div>
<div class="codehilite"><pre><span></span>sudo <span class="nv">$RUN_PHP</span> pear channel-update pear.php.net

sudo <span class="nv">$RUN_PHP</span> pear install Crypt_GPG    <span class="c1"># we need version &gt;1.3.0</span>

<span class="c1"># GPG needs lots of entropy, haveged provides entropy</span>
sudo yum install haveged
sudo chkconfig haveged on
sudo service haveged start

<span class="c1"># Enable and start redis</span>
sudo chkconfig redis on
sudo service redis start
</pre></div>

<h3 id="3-misp-code">3/ MISP code<a class="headerlink" href="#3-misp-code" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># Download MISP using git in the /var/www/ directory.</span>
<span class="nb">cd</span> /var/www/
sudo git clone https://github.com/MISP/MISP.git
<span class="nb">cd</span> /var/www/MISP
sudo git checkout tags/<span class="k">$(</span>git describe --tags <span class="sb">`</span>git rev-list --tags --max-count<span class="o">=</span><span class="m">1</span><span class="sb">`</span><span class="k">)</span>
<span class="c1"># if the last shortcut doesn&#39;t work, specify the latest version manually</span>
<span class="c1"># example: git checkout tags/v2.4.XY</span>
<span class="c1"># the message regarding a &quot;detached HEAD state&quot; is expected behaviour</span>
<span class="c1"># (you only have to create a new branch, if you want to change stuff and do a pull request for example)</span>

<span class="c1"># Make git ignore filesystem permission differences</span>
sudo git config core.filemode <span class="nb">false</span>

<span class="c1"># Fetch submodules</span>
<span class="nb">cd</span> /var/www/MISP
sudo git submodule update --init --recursive
<span class="c1"># Make git ignore filesystem permission differences for submodules</span>
sudo git submodule foreach --recursive git config core.filemode <span class="nb">false</span>

<span class="c1"># install Mitre&#39;s STIX and its dependencies by running the following commands:</span>
sudo yum install python-importlib python-lxml python-dateutil python-six -y
<span class="nb">cd</span> /var/www/MISP/app/files/scripts
sudo git clone https://github.com/CybOXProject/python-cybox.git
sudo git clone https://github.com/STIXProject/python-stix.git
<span class="nb">cd</span> /var/www/MISP/app/files/scripts/python-cybox
sudo git config core.filemode <span class="nb">false</span>
<span class="c1"># If you umask is has been changed from the default, it is a good idea to reset it to 0022 before installing python modules</span>
<span class="nv">UMASK</span><span class="o">=</span><span class="k">$(</span><span class="nb">umask</span><span class="k">)</span>
<span class="nb">umask</span> <span class="m">0022</span>
sudo <span class="nv">$RUN_PYTHON</span> <span class="s2">&quot;python3 setup.py install&quot;</span>
<span class="nb">cd</span> /var/www/MISP/app/files/scripts/python-stix
sudo git config core.filemode <span class="nb">false</span>
sudo <span class="nv">$RUN_PYTHON</span> <span class="s2">&quot;python3 setup.py install&quot;</span>

<span class="c1"># install maec</span>
sudo <span class="nv">$RUN_PYTHON</span> <span class="s2">&quot;pip install maec&quot;</span>

<span class="c1"># install zmq</span>
sudo <span class="nv">$RUN_PYTHON</span> <span class="s2">&quot;pip install zmq&quot;</span>

<span class="c1"># install redis</span>
sudo <span class="nv">$RUN_PYTHON</span> <span class="s2">&quot;pip install redis&quot;</span>

<span class="c1"># install mixbox to accommodate the new STIX dependencies:</span>
<span class="nb">cd</span> /var/www/MISP/app/files/scripts/
sudo git clone https://github.com/CybOXProject/mixbox.git
<span class="nb">cd</span> /var/www/MISP/app/files/scripts/mixbox
sudo git config core.filemode <span class="nb">false</span>
sudo <span class="nv">$RUN_PYTHON</span> <span class="s2">&quot;python3 setup.py install&quot;</span>

<span class="c1"># install PyMISP</span>
<span class="nb">cd</span> /var/www/MISP/PyMISP
sudo <span class="nv">$RUN_PYTHON</span> <span class="s2">&quot;python3 setup.py install&quot;</span>

<span class="c1"># Enable python3 for php-fpm</span>
<span class="nb">echo</span> <span class="s1">&#39;source scl_source enable rh-python36&#39;</span> <span class="p">|</span> sudo tee -a /etc/opt/rh/rh-php70/sysconfig/php-fpm
sudo sed -i.org -e <span class="s1">&#39;s/^;\(clear_env = no\)/\1/&#39;</span> /etc/opt/rh/rh-php70/php-fpm.d/www.conf
sudo service rh-php70-php-fpm restart

<span class="nb">umask</span> <span class="nv">$UMASK</span>
</pre></div>

<h3 id="4-cakephp">4/ CakePHP<a class="headerlink" href="#4-cakephp" title="Permanent link">&para;</a></h3>
<hr />
<h4 id="cakephp-is-now-included-as-a-submodule-of-misp-and-has-been-fetch-by-a-previous-step">CakePHP is now included as a submodule of MISP and has been fetch by a previous step.<a class="headerlink" href="#cakephp-is-now-included-as-a-submodule-of-misp-and-has-been-fetch-by-a-previous-step" title="Permanent link">&para;</a></h4>
<h4 id="install-cakeresque-along-with-its-dependencies-if-you-intend-to-use-the-built-in-background-jobs">Install CakeResque along with its dependencies if you intend to use the built in background jobs.<a class="headerlink" href="#install-cakeresque-along-with-its-dependencies-if-you-intend-to-use-the-built-in-background-jobs" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>sudo chown -R apache:apache /var/www/MISP
sudo mkdir /usr/share/httpd/.composer
sudo chown apache:apache /usr/share/httpd/.composer
<span class="nb">cd</span> /var/www/MISP/app
sudo -u apache <span class="nv">$RUN_PHP</span> <span class="s2">&quot;php composer.phar require kamisama/cake-resque:4.1.2&quot;</span>
sudo -u apache <span class="nv">$RUN_PHP</span> <span class="s2">&quot;php composer.phar config vendor-dir Vendor&quot;</span>
sudo -u apache <span class="nv">$RUN_PHP</span> <span class="s2">&quot;php composer.phar install&quot;</span>

<span class="c1"># CakeResque normally uses phpredis to connect to redis, but it has a (buggy) fallback connector through Redisent. It is highly advised to install phpredis</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;pecl install redis-2.2.8&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;extension=redis.so&quot;</span> <span class="p">|</span>sudo tee /etc/opt/rh/rh-php70/php-fpm.d/redis.ini
sudo ln -s ../php-fpm.d/redis.ini /etc/opt/rh/rh-php70/php.d/99-redis.ini
sudo service rh-php70-php-fpm restart

<span class="c1"># If you have not yet set a timezone in php.ini</span>
<span class="nb">echo</span> <span class="s1">&#39;date.timezone = &quot;Europe/Luxembourg&quot;&#39;</span> <span class="p">|</span>sudo tee /etc/opt/rh/rh-php70/php-fpm.d/timezone.ini
sudo ln -s ../php-fpm.d/timezone.ini /etc/opt/rh/rh-php70/php.d/99-timezone.ini

<span class="c1"># Recommended: Change some PHP settings in /etc/opt/rh/rh-php70/php.ini</span>
<span class="c1"># max_execution_time = 300</span>
<span class="c1"># memory_limit = 512M</span>
<span class="c1"># upload_max_filesize = 50M</span>
<span class="c1"># post_max_size = 50M</span>
<span class="k">for</span> key in upload_max_filesize post_max_size max_execution_time max_input_time memory_limit
<span class="k">do</span>
    sudo sed -i <span class="s2">&quot;s/^\(</span><span class="nv">$key</span><span class="s2">\).*/\1 = </span><span class="k">$(</span><span class="nb">eval</span> <span class="nb">echo</span> <span class="se">\$</span><span class="o">{</span><span class="nv">$key</span><span class="o">}</span><span class="k">)</span><span class="s2">/&quot;</span> <span class="nv">$PHP_INI</span>
<span class="k">done</span>
sudo systemctl restart rh-php70-php-fpm.service
<span class="c1"># To use the scheduler worker for scheduled tasks, do the following:</span>
sudo cp -fa /var/www/MISP/INSTALL/setup/config.php /var/www/MISP/app/Plugin/CakeResque/Config/config.php
</pre></div>

<h3 id="5-set-the-permissions">5/ Set the permissions<a class="headerlink" href="#5-set-the-permissions" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># Make sure the permissions are set correctly using the following commands as root:</span>
sudo chown -R root:apache /var/www/MISP
sudo find /var/www/MISP -type d -exec chmod <span class="nv">g</span><span class="o">=</span>rx <span class="o">{}</span> <span class="se">\;</span>
sudo chmod -R g+r,o<span class="o">=</span> /var/www/MISP
sudo chmod -R <span class="m">750</span> /var/www/MISP
sudo chmod -R g+ws /var/www/MISP/app/tmp
sudo chmod -R g+ws /var/www/MISP/app/files
sudo chmod -R g+ws /var/www/MISP/app/files/scripts/tmp
sudo chown apache:apache /var/www/MISP/app/files
sudo chown apache:apache /var/www/MISP/app/files/terms
sudo chown apache:apache /var/www/MISP/app/files/scripts/tmp
sudo chown apache:apache /var/www/MISP/app/Plugin/CakeResque/tmp
sudo chown -R apache:apache /var/www/MISP/app/Config
sudo chown -R apache:apache /var/www/MISP/app/tmp
sudo chown -R apache:apache /var/www/MISP/app/webroot/img/orgs
sudo chown -R apache:apache /var/www/MISP/app/webroot/img/custom
</pre></div>

<h3 id="6-create-a-database-and-user">6/ Create a database and user<a class="headerlink" href="#6-create-a-database-and-user" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># Enable, start and secure your mysql database server</span>
chkconfig mysqld on
service mysqld start
mysql_secure_installation
<span class="c1"># Additionally, it is probably a good idea to make the database server listen on localhost only</span>
<span class="c1"># Add the following to the [mysqld] of /etc/my.cnf</span>
<span class="c1"># bind-address=127.0.0.1</span>

<span class="c1"># Enter the mysql shell</span>
mysql -u root -p
</pre></div>

<div class="codehilite"><pre><span></span>mysql&gt; create database misp;
mysql&gt; grant usage on *.* to misp@localhost identified by &#39;XXXXXXXXX&#39;;
mysql&gt; grant all privileges on misp.* to misp@localhost ;
mysql&gt; exit
</pre></div>

<h4 id="copypaste">copy/paste:<a class="headerlink" href="#copypaste" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>sudo mysql -u <span class="nv">$DBUSER_ADMIN</span> -p<span class="nv">$DBPASSWORD_ADMIN</span> -e <span class="s2">&quot;create database </span><span class="nv">$DBNAME</span><span class="s2">;&quot;</span>
sudo mysql -u <span class="nv">$DBUSER_ADMIN</span> -p<span class="nv">$DBPASSWORD_ADMIN</span> -e <span class="s2">&quot;grant usage on *.* to </span><span class="nv">$DBNAME</span><span class="s2">@localhost identified by &#39;</span><span class="nv">$DBPASSWORD_MISP</span><span class="s2">&#39;;&quot;</span>
sudo mysql -u <span class="nv">$DBUSER_ADMIN</span> -p<span class="nv">$DBPASSWORD_ADMIN</span> -e <span class="s2">&quot;grant all privileges on </span><span class="nv">$DBNAME</span><span class="s2">.* to &#39;</span><span class="nv">$DBUSER_MISP</span><span class="s2">&#39;@&#39;localhost&#39;;&quot;</span>
sudo mysql -u <span class="nv">$DBUSER_ADMIN</span> -p<span class="nv">$DBPASSWORD_ADMIN</span> -e <span class="s2">&quot;flush privileges;&quot;</span>
</pre></div>

<h4 id="import-the-empty-mysql-database-from-mysqlsql">Import the empty MySQL database from MYSQL.sql<a class="headerlink" href="#import-the-empty-mysql-database-from-mysqlsql" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>sudo -u apache cat <span class="nv">$PATH_TO_MISP</span>/INSTALL/MYSQL.sql <span class="p">|</span> mysql -u <span class="nv">$DBUSER_MISP</span> -p<span class="nv">$DBPASSWORD_MISP</span> <span class="nv">$DBNAME</span>
</pre></div>

<h3 id="7-apache-configuration">7/ Apache configuration<a class="headerlink" href="#7-apache-configuration" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># Now configure your apache server with the DocumentRoot /var/www/MISP/app/webroot/</span>
<span class="c1"># A sample vhost can be found in /var/www/MISP/INSTALL/apache.misp.centos6</span>

sudo cp /var/www/MISP/INSTALL/apache.misp.centos6 /etc/httpd/conf.d/misp.conf

<span class="c1"># Allow httpd to connect to the redis server and php-fpm over tcp/ip</span>
sudo setsebool -P httpd_can_network_connect on

<span class="c1"># Enable and start the httpd service</span>
sudo chkconfig httpd on
sudo service httpd start

<span class="c1"># Open a hole in the iptables firewall</span>
sudo iptables -I INPUT <span class="m">5</span> -p tcp --dport <span class="m">80</span> -m state --state NEW,ESTABLISHED -j ACCEPT
sudo service iptables save

<span class="c1"># We seriously recommend using only HTTPS / SSL !</span>
<span class="c1"># Add SSL support by running: yum install mod_ssl</span>
<span class="c1"># Check out the apache.misp.ssl file for an example</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="c1"># If a valid SSL certificate is not already created for the server, create a self-signed certificate:</span>
sudo openssl req -newkey rsa:4096 -days <span class="m">365</span> -nodes -x509 <span class="se">\</span>
-subj <span class="s2">&quot;/C=</span><span class="si">${</span><span class="nv">OPENSSL_C</span><span class="si">}</span><span class="s2">/ST=</span><span class="si">${</span><span class="nv">OPENSSL_ST</span><span class="si">}</span><span class="s2">/L=</span><span class="si">${</span><span class="nv">OPENSSL_L</span><span class="si">}</span><span class="s2">/O=</span><span class="si">${</span><span class="nv">OPENSSL_O</span><span class="si">}</span><span class="s2">/OU=</span><span class="si">${</span><span class="nv">OPENSSL_OU</span><span class="si">}</span><span class="s2">/CN=</span><span class="si">${</span><span class="nv">OPENSSL_CN</span><span class="si">}</span><span class="s2">/emailAddress=</span><span class="si">${</span><span class="nv">OPENSSL_EMAILADDRESS</span><span class="si">}</span><span class="s2">&quot;</span> <span class="se">\</span>
-keyout /etc/ssl/private/misp.local.key -out /etc/ssl/private/misp.local.crt
</pre></div>

<h3 id="8-log-rotation">8/ Log rotation<a class="headerlink" href="#8-log-rotation" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span><span class="c1"># MISP saves the stdout and stderr of its workers in /var/www/MISP/app/tmp/logs</span>
<span class="c1"># To rotate these logs install the supplied logrotate script:</span>

sudo cp INSTALL/misp.logrotate /etc/logrotate.d/misp
sudo chmod <span class="m">0640</span> /etc/logrotate.d/misp
</pre></div>

<h3 id="9-misp-configuration">9/ MISP configuration<a class="headerlink" href="#9-misp-configuration" title="Permanent link">&para;</a></h3>
<hr />
<div class="codehilite"><pre><span></span># There are 4 sample configuration files in /var/www/MISP/app/Config that need to be copied
cd /var/www/MISP/app/Config
cp -a bootstrap.default.php bootstrap.php
cp -a database.default.php database.php
cp -a core.default.php core.php
cp -a config.default.php config.php

# Configure the fields in the newly created files:
# config.php   : baseurl
# database.php : login, port, password, database

# Important! Change the salt key in /var/www/MISP/app/Config/config.php
# The admin user account will be generated on the first login, make sure that the salt is changed before you create that user
# If you forget to do this step, and you are still dealing with a fresh installation, just alter the salt,
# delete the user from mysql and log in again using the default admin credentials (admin@admin.test / admin)

# If you want to be able to change configuration parameters from the webinterface:
sudo chown apache:apache /var/www/MISP/app/Config/config.php

# Generate a GPG encryption key.
# If the following command gives an error message, try it as root from the console
gpg --gen-key
mv ~/.gnupg /var/www/MISP/
chown -R apache:apache /var/www/MISP/.gnupg

# The email address should match the one set in the config.php configuration file
# Make sure that you use the same settings in the MISP Server Settings tool (Described on line 232)

# And export the public key to the webroot
sudo -u apache gpg --homedir /var/www/MISP/.gnupg --export --armor YOUR-EMAIL &gt; /var/www/MISP/app/webroot/gpg.asc

# Start the workers to enable background jobs
sudo chmod +x /var/www/MISP/app/Console/worker/start.sh
su -s /bin/bash apache -c &#39;scl enable rh-php70 /var/www/MISP/app/Console/worker/start.sh&#39;

# To make the background workers start on boot
vi /etc/rc.local
# Add the following line at the end
su -s /bin/bash apache -c &#39;scl enable rh-php70 /var/www/MISP/app/Console/worker/start.sh&#39;
</pre></div>

<h4 id="initialize-misp-configuration-and-set-some-defaults">Initialize MISP configuration and set some defaults<a class="headerlink" href="#initialize-misp-configuration-and-set-some-defaults" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="c1"># Initialize user and fetch Auth Key</span>
sudo -E <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> userInit -q&quot;</span>
<span class="nv">AUTH_KEY</span><span class="o">=</span><span class="k">$(</span>mysql -u <span class="nv">$DBUSER_MISP</span> -p<span class="nv">$DBPASSWORD_MISP</span> misp -e <span class="s2">&quot;SELECT authkey FROM users;&quot;</span> <span class="p">|</span> tail -1<span class="k">)</span>

<span class="c1"># A small sleep to make sure all the db migrations are done, in case of copy-pasta</span>
sleep <span class="m">30</span>

<span class="c1"># Setup some more MISP default via cake CLI</span>

<span class="c1"># Change base url, either with this CLI command or in the UI</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Baseurl </span><span class="nv">$MISP_BASEURL</span><span class="s2">&quot;</span>
<span class="c1"># example: &#39;baseurl&#39; =&gt; &#39;https://&lt;your.FQDN.here&gt;&#39;,</span>
<span class="c1"># alternatively, you can leave this field empty if you would like to use relative pathing in MISP</span>
<span class="c1"># &#39;baseurl&#39; =&gt; &#39;&#39;,</span>

<span class="c1"># Tune global time outs</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Session.autoRegenerate<span class="s2">&quot; 0&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Session.timeout<span class="s2">&quot; 600&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Session.cookie_timeout<span class="s2">&quot; 3600&quot;</span>

<span class="c1"># Enable GnuPG</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>GnuPG.email<span class="s2">&quot; &quot;</span>admin@admin.test<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>GnuPG.homedir<span class="s2">&quot; &quot;</span><span class="nv">$PATH_TO_MISP</span>/.gnupg<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>GnuPG.password<span class="s2">&quot; &quot;</span>Password1234<span class="s2">&quot;&quot;</span>

<span class="c1"># Enable Enrichment set better timeouts</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Enrichment_services_enable<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Enrichment_hover_enable<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Enrichment_timeout<span class="s2">&quot; 300&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Enrichment_hover_timeout<span class="s2">&quot; 150&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Enrichment_cve_enabled<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Enrichment_dns_enabled<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Enrichment_services_url<span class="s2">&quot; &quot;</span>http://127.0.0.1<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Enrichment_services_port<span class="s2">&quot; 6666&quot;</span>

<span class="c1"># Enable Import modules set better timout</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Import_services_enable<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Import_services_url<span class="s2">&quot; &quot;</span>http://127.0.0.1<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Import_services_port<span class="s2">&quot; 6666&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Import_timeout<span class="s2">&quot; 300&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Import_ocr_enabled<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Import_csvimport_enabled<span class="s2">&quot; true&quot;</span>

<span class="c1"># Enable Export modules set better timout</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Export_services_enable<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Export_services_url<span class="s2">&quot; &quot;</span>http://127.0.0.1<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Export_services_port<span class="s2">&quot; 6666&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Export_timeout<span class="s2">&quot; 300&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Export_pdfexport_enabled<span class="s2">&quot; true&quot;</span>

<span class="c1"># Enable installer org and tune some configurables</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.host_org_id<span class="s2">&quot; 1&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.email<span class="s2">&quot; &quot;</span>info@admin.test<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.disable_emailing<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.contact<span class="s2">&quot; &quot;</span>info@admin.test<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.disablerestalert<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.showCorrelationsOnIndex<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.default_event_tag_collection<span class="s2">&quot; 0&quot;</span>

<span class="c1"># Provisional Cortex tunes</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Cortex_services_enable<span class="s2">&quot; false&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Cortex_services_url<span class="s2">&quot; &quot;</span>http://127.0.0.1<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Cortex_services_port<span class="s2">&quot; 9000&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Cortex_timeout<span class="s2">&quot; 120&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Cortex_services_url<span class="s2">&quot; &quot;</span>http://127.0.0.1<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Cortex_services_port<span class="s2">&quot; 9000&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Cortex_services_timeout<span class="s2">&quot; 120&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Cortex_services_authkey<span class="s2">&quot; &quot;&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Cortex_ssl_verify_peer<span class="s2">&quot; false&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Cortex_ssl_verify_host<span class="s2">&quot; false&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Cortex_ssl_allow_self_signed<span class="s2">&quot; true&quot;</span>

<span class="c1"># Various plugin sightings settings</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Sightings_policy<span class="s2">&quot; 0&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Sightings_anonymise<span class="s2">&quot; false&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.Sightings_range<span class="s2">&quot; 365&quot;</span>

<span class="c1"># Plugin CustomAuth tuneable</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.CustomAuth_disable_logout<span class="s2">&quot; false&quot;</span>

<span class="c1"># RPZ Plugin settings</span>

sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.RPZ_policy<span class="s2">&quot; &quot;</span>DROP<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.RPZ_walled_garden<span class="s2">&quot; &quot;</span><span class="m">127</span>.0.0.1<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.RPZ_serial<span class="s2">&quot; &quot;</span><span class="se">\$</span>date00<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.RPZ_refresh<span class="s2">&quot; &quot;</span>2h<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.RPZ_retry<span class="s2">&quot; &quot;</span>30m<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.RPZ_expiry<span class="s2">&quot; &quot;</span>30d<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.RPZ_minimum_ttl<span class="s2">&quot; &quot;</span>1h<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.RPZ_ttl<span class="s2">&quot; &quot;</span>1w<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.RPZ_ns<span class="s2">&quot; &quot;</span>localhost.<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.RPZ_ns_alt<span class="s2">&quot; &quot;&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Plugin.RPZ_email<span class="s2">&quot; &quot;</span>root.localhost<span class="s2">&quot;&quot;</span>

<span class="c1"># Force defaults to make MISP Server Settings less RED</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.language<span class="s2">&quot; &quot;</span>eng<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.proposals_block_attributes<span class="s2">&quot; false&quot;</span>

<span class="c1">## Redis block</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.redis_host<span class="s2">&quot; &quot;</span><span class="m">127</span>.0.0.1<span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.redis_port<span class="s2">&quot; 6379&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.redis_database<span class="s2">&quot; 13&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.redis_password<span class="s2">&quot; &quot;&quot;&quot;</span>

<span class="c1"># Force defaults to make MISP Server Settings less YELLOW</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.ssdeep_correlation_threshold<span class="s2">&quot; 40&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.extended_alert_subject<span class="s2">&quot; false&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.default_event_threat_level<span class="s2">&quot; 4&quot;</span>

<span class="c1">##sudo $RUN_PHP &#39;$CAKE Admin setSetting &quot;MISP.newUserText&quot; &quot;Dear new MISP user,\\n\\nWe would hereby like to welcome you to the \$org MISP community.\\n\\n Use the credentials below to log into MISP at \$misp, where you will be prompted to manually change your password to something of your own choice.\\n\\nUsername: \$username\\nPassword: \$password\\n\\nIf you have any questions, don&#39;t hesitate to contact us at: \$contact.\\n\\nBest regards,\\nYour \$org MISP support team&quot;&#39;</span>
<span class="c1">##sudo $CAKE Admin setSetting &quot;MISP.passwordResetText&quot; &quot;Dear MISP user,\\n\\nA password reset has been triggered for your account. Use the below provided temporary password to log into MISP at \$misp, where you will be prompted to manually change your password to something of your own choice.\\n\\nUsername: \$username\\nYour temporary password: \$password\\n\\nIf you have any questions, don&#39;t hesitate to contact us at: \$contact.\\n\\nBest regards,\\nYour \$org MISP support team&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.enableEventBlacklisting<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.enableOrgBlacklisting<span class="s2">&quot; true&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.log_client_ip<span class="s2">&quot; false&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.log_auth<span class="s2">&quot; false&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.disableUserSelfManagement<span class="s2">&quot; false&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.block_event_alert<span class="s2">&quot; false&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.block_event_alert_tag<span class="s2">&quot; &quot;</span>no-alerts<span class="o">=</span><span class="se">\&quot;</span>true<span class="se">\&quot;</span><span class="s2">&quot;&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.block_old_event_alert<span class="s2">&quot; false&quot;</span>
<span class="c1">##sudo $RUN_PHP &quot;$CAKE Admin setSetting &quot;MISP.block_old_event_alert_age&quot; &quot;&quot;&quot;</span>
<span class="c1">##sudo $RUN_PHP &quot;$CAKE Admin setSetting &quot;MISP.incoming_tags_disabled_by_default&quot; false&quot;</span>
<span class="c1">##sudo $RUN_PHP &quot;$CAKE Admin setSetting &quot;MISP.footermidleft&quot; &quot;This is an initial install&quot;&quot;</span>
<span class="c1">##sudo $RUN_PHP &quot;$CAKE Admin setSetting &quot;MISP.footermidright&quot; &quot;Please configure and harden accordingly&quot;&quot;</span>
<span class="c1">##sudo $RUN_PHP &quot;$CAKE Admin setSetting &quot;MISP.welcome_text_top&quot; &quot;Initial Install, please configure&quot;&quot;</span>
<span class="c1">##sudo $RUN_PHP &quot;$CAKE Admin setSetting &quot;MISP.welcome_text_bottom&quot; &quot;Welcome to MISP, change this message in MISP Settings&quot;&quot;</span>

<span class="c1"># Force defaults to make MISP Server Settings less GREEN</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Security.password_policy_length<span class="s2">&quot; 12&quot;</span>
<span class="c1">##sudo $RUN_PHP &quot;$CAKE Admin setSetting &quot;Security.password_policy_complexity&quot; &#39;/^((?=.*\d)|(?=.*\W+))(?![\n])(?=.*[A-Z])(?=.*[a-z]).*$|.{16,}/&#39;&quot;</span>
<span class="c1"># Tune global time outs</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Session.autoRegenerate<span class="s2">&quot; 0&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Session.timeout<span class="s2">&quot; 600&quot;</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>Session.cookie_timeout<span class="s2">&quot; 3600&quot;</span>

<span class="c1"># Update the galaxies…</span>
<span class="c1">##sudo $RUN_PHP &quot;$CAKE Admin updateGalaxies&quot;</span>
curl --header <span class="s2">&quot;Authorization: </span><span class="nv">$AUTH_KEY</span><span class="s2">&quot;</span> --header <span class="s2">&quot;Accept: application/json&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -k -X POST https://127.0.0.1/galaxies/update

<span class="c1"># Updating the taxonomies…</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin updateTaxonomies&quot;</span>

<span class="c1"># Updating the warning lists…</span>
<span class="c1">##sudo $RUN_PHP &quot;$CAKE Admin updateWarningLists&quot;</span>
curl --header <span class="s2">&quot;Authorization: </span><span class="nv">$AUTH_KEY</span><span class="s2">&quot;</span> --header <span class="s2">&quot;Accept: application/json&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -k -X POST https://127.0.0.1/warninglists/update

<span class="c1"># Updating the notice lists…</span>
<span class="c1">## sudo $RUN_PHP &quot;$CAKE Admin updateNoticeLists&quot;</span>
curl --header <span class="s2">&quot;Authorization: </span><span class="nv">$AUTH_KEY</span><span class="s2">&quot;</span> --header <span class="s2">&quot;Accept: application/json&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -k -X POST https://127.0.0.1/noticelists/update

<span class="c1"># Updating the object templates…</span>
<span class="c1">##sudo $RUN_PHP &quot;$CAKE Admin updateObjectTemplates&quot;</span>
curl --header <span class="s2">&quot;Authorization: </span><span class="nv">$AUTH_KEY</span><span class="s2">&quot;</span> --header <span class="s2">&quot;Accept: application/json&quot;</span> --header <span class="s2">&quot;Content-Type: application/json&quot;</span> -k -X POST https://127.0.0.1/objectTemplates/update

<span class="c1"># Set MISP Live</span>
sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Live </span><span class="nv">$MISP_LIVE</span><span class="s2">&quot;</span>
</pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you have installed the recommended Python 3 virtualenv to the recommended place of <strong>${PATH_TO_MISP}/venv</strong> set the following MISP configurable
<div class="codehilite"><pre><span></span>sudo -H -u www-data <span class="nv">$CAKE</span> Admin setSetting <span class="s2">&quot;MISP.python_bin&quot;</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span><span class="s2">/venv/bin/python&quot;</span>
</pre></div>
or on CentOS
<div class="codehilite"><pre><span></span>sudo <span class="nv">$RUN_PHP</span> <span class="s2">&quot;</span><span class="nv">$CAKE</span><span class="s2"> Admin setSetting &quot;</span>MISP.python_bin<span class="s2">&quot; &quot;</span><span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/venv/bin/python<span class="s2">&quot;&quot;</span>
</pre></div></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure that the STIX libraries and GnuPG work as intended, if not, refer to the relevant sections in the install guide you are currently reading.</p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>Now log in using the webinterface: http://misp/users/login<br />
The default user/pass = <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#97;&#100;&#109;&#105;&#110;&#64;&#97;&#100;&#109;&#105;&#110;&#46;&#116;&#101;&#115;&#116;">&#97;&#100;&#109;&#105;&#110;&#64;&#97;&#100;&#109;&#105;&#110;&#46;&#116;&#101;&#115;&#116;</a>/admin<br />
Using the server settings tool in the admin interface (Administration -&gt; Server Settings), set MISP up to your preference.<br />
It is especially vital that no critical issues remain!<br />
Don't forget to change the email, password and authentication key after installation.<br />
Once done, have a look at the diagnostics.</p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>If any of the directories that MISP uses to store files is not writeable to the apache user, change the permissions<br />
you can do this by running the following commands:
<div class="codehilite"><pre><span></span>chmod -R <span class="m">750</span> <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/&lt;directory path with an indicated issue&gt;
<span class="c1"># /!\ Depending on your OS replace www-data with apache or www or whatever user is the web server user.</span>
chown -R www-data:www-data <span class="si">${</span><span class="nv">PATH_TO_MISP</span><span class="si">}</span>/&lt;directory path with an indicated issue&gt;
</pre></div></p>
</div>
<div class="admonition notice">
<p class="admonition-title">Notice</p>
<p>If anything goes wrong, make sure that you check MISP's logs for errors:
<div class="codehilite"><pre><span></span># ${PATH_TO_MISP}/app/tmp/logs/error.log
# ${PATH_TO_MISP}/app/tmp/logs/resque-worker-error.log
# ${PATH_TO_MISP}/app/tmp/logs/resque-scheduler-error.log
# ${PATH_TO_MISP}/app/tmp/logs/resque-2018-10-25.log //where the actual date is the current date
</pre></div></p>
</div>
<h3 id="recommended-actions">Recommended actions<a class="headerlink" href="#recommended-actions" title="Permanent link">&para;</a></h3>
<hr />
<ul>
<li>
<p>By default CakePHP exposes its name and version in email headers. Apply a patch to remove this behavior.</p>
</li>
<li>
<p>You should really harden your OS</p>
</li>
<li>You should really harden the configuration of Apache</li>
<li>You should really harden the configuration of MySQL</li>
<li>Keep your software up2date (MISP, CakePHP and everything else)</li>
<li>Log and audit</li>
</ul>
<h1 id="hardening-a-base-system">Hardening a base system<a class="headerlink" href="#hardening-a-base-system" title="Permanent link">&para;</a></h1>
<h2 id="intro">Intro<a class="headerlink" href="#intro" title="Permanent link">&para;</a></h2>
<p>MISP is a web-based <strong>information sharing platform</strong>, by design it is kept rather simple and hardening can be done by following the common best practices.</p>
<p>Bare in mind that neither the MISP documentation efforts or the core MISP project can give you the ultimate guide on how to harden your system.
This is not the purpose of the MISP Project but the purpose and care of those individuals and organizations deploying MISP Instances.</p>
<p>Nevertheless here is a very rough <strong>food for thoughts</strong> bulletpoint list for you to consider, and a list of some hardening ressources below.</p>
<ul>
<li>Are we using SSL by default? (Especially when syncing over the internet and exposing the API)</li>
<li>How to we access the machine remotely? Via ssh? What is the path to get there? Does a <a href="https://en.wikipedia.org/wiki/Bastion_host">bastion host</a> make sense?</li>
<li>Is the machine shared with other user accounts? Do I need to care about useri-land security due to this sharing?</li>
<li>Is the instance deployed in the "<strong>cloud</strong>"? Is it a VPS? AWS? docker? ansible? kubernetes? whateverCloudContainterMagicIsFancibleNow?</li>
<li>Do we need to encrypt the partitions where some data is stored?</li>
<li>Are we redundant in case one MISP instance might fail?</li>
<li>Is the database server and any other servers running on the machine bound to <strong>localhost</strong>? Do we need to expose because our setup is more complex?</li>
<li>Do we have enough storage? What about <a href="https://misp-project.org/MISP-sizer/">MISP and size estimation</a> anyways?</li>
<li>Do we care about BIOS updates?</li>
<li>Do we care about physical access to the servers? (Disabling USB ports etc...)</li>
<li>Is any fancy management engine à la <a href="https://en.wikipedia.org/wiki/Intel_Management_Engine">IME</a> in use?</li>
</ul>
<h2 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h2>
<p><a href="https://wiki.debian.org/Hardening">Debian Wiki Hardening</a></p>
<p><a href="https://wiki.centos.org/HowTos/OS_Protection">CentOS Hardening</a></p>
<p><a href="https://www.cyberciti.biz/tips/linux-security.html">Some Linux hardening tips</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../xINSTALL/" title="Warning" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Warning
              </span>
            </div>
          </a>
        
        
          <a href="../xINSTALL.centos7/" title="Centos 7" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Centos 7
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 MISP Project
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://www.misp-project.org/" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/MISP" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/MISPProject" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>